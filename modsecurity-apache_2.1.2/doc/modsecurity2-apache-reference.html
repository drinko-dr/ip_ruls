<html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>ModSecurity Reference Manual</title><link href="modsecurity-reference.css" rel="stylesheet" type="text/css"><meta content="DocBook XSL Stylesheets V1.69.1" name="generator"><link rel="start" href="#N10001" title="ModSecurity Reference Manual"><link rel="next" href="#01-introduction" title="Introduction"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div style="background:#F5F5F5;width:100%;border-top:1px solid #DDDDDD;border-bottom:1px solid #DDDDDD"><table width="100%" cellspacing="0" cellpadding="0"><tr><td><a href="http://www.modsecurity.org"><img style="margin:4px" src="modsecurity.gif" width="120" height="36" alt="ModSecurity" border="0"></a></td><td align="right"><a href="http://www.breach.com"><img style="margin:6px" src="breach-logo-small.gif" height="36" width="100" border="0"></a></td></tr></table></div><div class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="N10001"></a>ModSecurity Reference Manual</h2></div><div><p class="releaseinfo">Version 2.1.2 / (July 27, 2007)</p></div><div><p class="copyright">Copyright &copy; 2004-2007 Breach Security, Inc. (<a href="http://www.breach.com" target="_top">http://www.breach.com</a>)</p></div></div><div></div><hr size="1"></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#01-introduction">Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#N1001D">HTTP Traffic Logging</a></span></dt><dt><span class="section"><a href="#N10022">Real-Time Monitoring and Attack Detection</a></span></dt><dt><span class="section"><a href="#N10027">Attack Prevention and Just-in-time Patching</a></span></dt><dt><span class="section"><a href="#N10038">Flexible Rule Engine</a></span></dt><dt><span class="section"><a href="#N1003D">Embedded-mode Deployment</a></span></dt><dt><span class="section"><a href="#N10058">Network-based Deployment</a></span></dt><dt><span class="section"><a href="#03-licensing">Licensing</a></span></dt></dl></dd><dt><span class="section"><a href="#N10066">ModSecurity Core Rules</a></span></dt><dd><dl><dt><span class="section"><a href="#N10069">Overview</a></span></dt><dt><span class="section"><a href="#N10072">Core Rules Structure</a></span></dt><dt><span class="section"><a href="#N1008A">Core Rules Content</a></span></dt></dl></dd><dt><span class="section"><a href="#02-installation">Installation</a></span></dt><dt><span class="section"><a href="#03-configuration-directives">Configuration Directives</a></span></dt><dd><dl><dt><span class="section"><a href="#N10119"><code class="literal">SecAction</code></a></span></dt><dt><span class="section"><a href="#N10147"><code class="literal">SecArgumentSeparator</code></a></span></dt><dt><span class="section"><a href="#N10181"><code class="literal">SecAuditEngine</code></a></span></dt><dt><span class="section"><a href="#N101CD"><code class="literal">SecAuditLog</code></a></span></dt><dt><span class="section"><a href="#N101FE"><code class="literal">SecAuditLog2</code></a></span></dt><dt><span class="section"><a href="#N10232"><code class="literal">SecAuditLogParts</code></a></span></dt><dt><span class="section"><a href="#N102BD"><code class="literal">SecAuditLogRelevantStatus</code></a></span></dt><dt><span class="section"><a href="#N102E7"><code class="literal">SecAuditLogStorageDir</code></a></span></dt><dt><span class="section"><a href="#N10311"><code class="literal">SecAuditLogType</code></a></span></dt><dt><span class="section"><a href="#N1034A"><code class="literal">SecChrootDir</code></a></span></dt><dt><span class="section"><a href="#N10372"><code class="literal">SecCookieFormat</code></a></span></dt><dt><span class="section"><a href="#N103A9"><code class="literal">SecDataDir</code></a></span></dt><dt><span class="section"><a href="#N103D5"><code class="literal">SecDebugLog</code></a></span></dt><dt><span class="section"><a href="#N103FD"><code class="literal">SecDebugLogLevel</code></a></span></dt><dt><span class="section"><a href="#N1045E"><code class="literal">SecDefaultAction</code></a></span></dt><dt><span class="section"><a href="#N10491"><code class="literal">SecGuardianLog</code></a></span></dt><dt><span class="section"><a href="#N104C5"><code class="literal">SecRequestBodyAccess</code></a></span></dt><dt><span class="section"><a href="#N104FC"><code class="literal">SecRequestBodyLimit</code></a></span></dt><dt><span class="section"><a href="#N10524"><code class="literal">SecRequestBodyInMemoryLimit</code></a></span></dt><dt><span class="section"><a href="#N10551"><code class="literal">SecResponseBodyLimit</code></a></span></dt><dt><span class="section"><a href="#N1057E"><code class="literal">SecResponseBodyMimeType</code></a></span></dt><dt><span class="section"><a href="#N105BB"><code class="literal">SecResponseBodyMimeTypesClear</code></a></span></dt><dt><span class="section"><a href="#N105E7"><code class="literal">SecResponseBodyAccess</code></a></span></dt><dt><span class="section"><a href="#N1061E"><code class="literal">SecRule</code></a></span></dt><dt><span class="section"><a href="#N10695"><code class="literal">SecRuleInheritance</code></a></span></dt><dt><span class="section"><a href="#N106E4"><code class="literal">SecRuleEngine</code></a></span></dt><dt><span class="section"><a href="#N10721"><code class="literal">SecRuleRemoveById</code></a></span></dt><dt><span class="section"><a href="#N1074C"><code class="literal">SecRuleRemoveByMsg</code></a></span></dt><dt><span class="section"><a href="#N10778"><code class="literal">SecServerSignature</code></a></span></dt><dt><span class="section"><a href="#N107A0"><code class="literal">SecTmpDir</code></a></span></dt><dt><span class="section"><a href="#N107C8"><code class="literal">SecUploadDir</code></a></span></dt><dt><span class="section"><a href="#N107F7"><code class="literal">SecUploadKeepFiles</code></a></span></dt><dt><span class="section"><a href="#N10838"><code class="literal">SecWebAppId</code></a></span></dt></dl></dd><dt><span class="section"><a href="#04-processing-phases">Processing Phases</a></span></dt><dd><dl><dt><span class="section"><a href="#N108BC">Phase Request Headers</a></span></dt><dt><span class="section"><a href="#N108C7">Phase Request Body</a></span></dt><dt><span class="section"><a href="#N108D8">Phase Response Headers</a></span></dt><dt><span class="section"><a href="#N108DD">Phase Response Body</a></span></dt><dt><span class="section"><a href="#N108E2">Phase Logging</a></span></dt></dl></dd><dt><span class="section"><a href="#05-variables">Variables</a></span></dt><dd><dl><dt><span class="section"><a href="#N108ED"><code class="literal">ARGS</code></a></span></dt><dt><span class="section"><a href="#N1092E"><code class="literal">ARGS_COMBINED_SIZE</code></a></span></dt><dt><span class="section"><a href="#N1093C"><code class="literal">ARGS_NAMES</code></a></span></dt><dt><span class="section"><a href="#N1094A"><code class="literal">AUTH_TYPE</code></a></span></dt><dt><span class="section"><a href="#N10961"><code class="literal">ENV</code></a></span></dt><dt><span class="section"><a href="#N10973"><code class="literal">FILES</code></a></span></dt><dt><span class="section"><a href="#N10981"><code class="literal">FILES_COMBINED_SIZE</code></a></span></dt><dt><span class="section"><a href="#N1098F"><code class="literal">FILES_NAMES</code></a></span></dt><dt><span class="section"><a href="#N1099D"><code class="literal">FILES_SIZES</code></a></span></dt><dt><span class="section"><a href="#N109AB"><code class="literal">FILES_TMPNAMES</code></a></span></dt><dt><span class="section"><a href="#N109BD"><code class="literal">HTTP_</code></a></span></dt><dt><span class="section"><a href="#N109D4"><code class="literal">PATH_INFO</code></a></span></dt><dt><span class="section"><a href="#N109E2"><code class="literal">QUERY_STRING</code></a></span></dt><dt><span class="section"><a href="#N109F0"><code class="literal">REMOTE_ADDR</code></a></span></dt><dt><span class="section"><a href="#N109FE"><code class="literal">REMOTE_HOST</code></a></span></dt><dt><span class="section"><a href="#N10A0C"><code class="literal">REMOTE_PORT</code></a></span></dt><dt><span class="section"><a href="#N10A1D"><code class="literal">REMOTE_USER</code></a></span></dt><dt><span class="section"><a href="#N10A31"><code class="literal">REQBODY_PROCESSOR</code></a></span></dt><dt><span class="section"><a href="#N10A4B"><code class="literal">REQBODY_PROCESSOR_ERROR</code></a></span></dt><dt><span class="section"><a href="#N10A64"><code class="literal">REQBODY_PROCESSOR_ERROR_MSG</code></a></span></dt><dt><span class="section"><a href="#N10A72"><code class="literal">REQUEST_BASENAME</code></a></span></dt><dt><span class="section"><a href="#N10A83"><code class="literal">REQUEST_BODY</code></a></span></dt><dt><span class="section"><a href="#N10A97"><code class="literal">REQUEST_COOKIES</code></a></span></dt><dt><span class="section"><a href="#N10AA5"><code class="literal">REQUEST_COOKIES_NAMES</code></a></span></dt><dt><span class="section"><a href="#N10AB3"><code class="literal">REQUEST_FILENAME</code></a></span></dt><dt><span class="section"><a href="#N10AC1"><code class="literal">REQUEST_HEADERS</code></a></span></dt><dt><span class="section"><a href="#N10ADB"><code class="literal">REQUEST_HEADERS_NAMES</code></a></span></dt><dt><span class="section"><a href="#N10AE9"><code class="literal">REQUEST_LINE</code></a></span></dt><dt><span class="section"><a href="#N10AFD"><code class="literal">REQUEST_METHOD</code></a></span></dt><dt><span class="section"><a href="#N10B11"><code class="literal">REQUEST_PROTOCOL</code></a></span></dt><dt><span class="section"><a href="#N10B25"><code class="literal">REQUEST_URI</code></a></span></dt><dt><span class="section"><a href="#N10B33"><code class="literal">REQUEST_URI_RAW</code></a></span></dt><dt><span class="section"><a href="#N10B41"><code class="literal">RESPONSE_BODY</code></a></span></dt><dt><span class="section"><a href="#N10B4F"><code class="literal">RESPONSE_HEADERS</code></a></span></dt><dt><span class="section"><a href="#N10B66"><code class="literal">RESPONSE_HEADERS_NAMES</code></a></span></dt><dt><span class="section"><a href="#N10B7A"><code class="literal">RESPONSE_PROTOCOL</code></a></span></dt><dt><span class="section"><a href="#N10B88"><code class="literal">RESPONSE_STATUS</code></a></span></dt><dt><span class="section"><a href="#N10B9C"><code class="literal">RULE</code></a></span></dt><dt><span class="section"><a href="#N10BBE"><code class="literal">SCRIPT_BASENAME</code></a></span></dt><dt><span class="section"><a href="#N10BD2"><code class="literal">SCRIPT_FILENAME</code></a></span></dt><dt><span class="section"><a href="#N10BE6"><code class="literal">SCRIPT_GID</code></a></span></dt><dt><span class="section"><a href="#N10BFA"><code class="literal">SCRIPT_GROUPNAME</code></a></span></dt><dt><span class="section"><a href="#N10C0E"><code class="literal">SCRIPT_MODE</code></a></span></dt><dt><span class="section"><a href="#N10C22"><code class="literal">SCRIPT_UID</code></a></span></dt><dt><span class="section"><a href="#N10C36"><code class="literal">SCRIPT_USERNAME</code></a></span></dt><dt><span class="section"><a href="#N10C4A"><code class="literal">SERVER_ADDR</code></a></span></dt><dt><span class="section"><a href="#N10C58"><code class="literal">SERVER_NAME</code></a></span></dt><dt><span class="section"><a href="#N10C6C"><code class="literal">SERVER_PORT</code></a></span></dt><dt><span class="section"><a href="#N10C7A"><code class="literal">SESSION</code></a></span></dt><dt><span class="section"><a href="#N10C98"><code class="literal">SESSIONID</code></a></span></dt><dt><span class="section"><a href="#N10CAA"><code class="literal">TIME</code></a></span></dt><dt><span class="section"><a href="#N10CB8"><code class="literal">TIME_DAY</code></a></span></dt><dt><span class="section"><a href="#N10CC6"><code class="literal">TIME_EPOCH</code></a></span></dt><dt><span class="section"><a href="#N10CD4"><code class="literal">TIME_HOUR</code></a></span></dt><dt><span class="section"><a href="#N10CE2"><code class="literal">TIME_MIN</code></a></span></dt><dt><span class="section"><a href="#N10CF0"><code class="literal">TIME_MON</code></a></span></dt><dt><span class="section"><a href="#N10CFE"><code class="literal">TIME_SEC</code></a></span></dt><dt><span class="section"><a href="#N10D0C"><code class="literal">TIME_WDAY</code></a></span></dt><dt><span class="section"><a href="#N10D1A"><code class="literal">TIME_YEAR</code></a></span></dt><dt><span class="section"><a href="#N10D28"><code class="literal">TX</code></a></span></dt><dt><span class="section"><a href="#N10D3A"><code class="literal">USERID</code></a></span></dt><dt><span class="section"><a href="#N10D4C"><code class="literal">WEBAPPID</code></a></span></dt><dt><span class="section"><a href="#N10D5E"><code class="literal">WEBSERVER_ERROR_LOG</code></a></span></dt><dt><span class="section"><a href="#N10D6C"><code class="literal">XML</code></a></span></dt></dl></dd><dt><span class="section"><a href="#06-transformation-functions">Transformation functions</a></span></dt><dd><dl><dt><span class="section"><a href="#N10DC5"><code class="literal">base64Decode</code></a></span></dt><dt><span class="section"><a href="#N10DCB"><code class="literal">base64Encode</code></a></span></dt><dt><span class="section"><a href="#N10DD1"><code class="literal">compressWhitespace</code></a></span></dt><dt><span class="section"><a href="#N10DD7"><code class="literal">escapeSeqDecode</code></a></span></dt><dt><span class="section"><a href="#N10E11"><code class="literal">hexDecode</code></a></span></dt><dt><span class="section"><a href="#N10E17"><code class="literal">hexEncode</code></a></span></dt><dt><span class="section"><a href="#N10E1D"><code class="literal">htmlEntityDecode</code></a></span></dt><dt><span class="section"><a href="#N10E5C"><code class="literal">lowercase</code></a></span></dt><dt><span class="section"><a href="#N10E62"><code class="literal">md5</code></a></span></dt><dt><span class="section"><a href="#N10E68"><code class="literal"><code class="literal">none</code></code></a></span></dt><dt><span class="section"><a href="#N10E6F"><code class="literal">normalisePath</code></a></span></dt><dt><span class="section"><a href="#N10E75"><code class="literal">normalisePathWin</code></a></span></dt><dt><span class="section"><a href="#N10E7B"><code class="literal">removeNulls</code></a></span></dt><dt><span class="section"><a href="#N10E81"><code class="literal">removeWhitespace</code></a></span></dt><dt><span class="section"><a href="#N10E87"><code class="literal">replaceComments</code></a></span></dt><dt><span class="section"><a href="#N10E95"><code class="literal">replaceNulls</code></a></span></dt><dt><span class="section"><a href="#N10E9B"><code class="literal">urlDecode</code></a></span></dt><dt><span class="section"><a href="#N10EA5"><code class="literal">urlDecodeUni</code></a></span></dt><dt><span class="section"><a href="#N10EB3"><code class="literal">urlEncode</code></a></span></dt><dt><span class="section"><a href="#N10EB9"><code class="literal">sha1</code></a></span></dt></dl></dd><dt><span class="section"><a href="#07-actions">Actions</a></span></dt><dd><dl><dt><span class="section"><a href="#N10EF1"><code class="literal">allow</code></a></span></dt><dt><span class="section"><a href="#N10F11"><code class="literal">auditlog</code></a></span></dt><dt><span class="section"><a href="#N10F2E"><code class="literal">capture</code></a></span></dt><dt><span class="section"><a href="#N10F4B"><code class="literal">chain</code></a></span></dt><dt><span class="section"><a href="#N10F6B"><code class="literal">ctl</code></a></span></dt><dt><span class="section"><a href="#N10FE1"><code class="literal">deny</code></a></span></dt><dt><span class="section"><a href="#N10FF8"><code class="literal">deprecatevar</code></a></span></dt><dt><span class="section"><a href="#N11011"><code class="literal">drop</code></a></span></dt><dt><span class="section"><a href="#N1102E"><code class="literal">exec</code></a></span></dt><dt><span class="section"><a href="#N1104B"><code class="literal">expirevar</code></a></span></dt><dt><span class="section"><a href="#N11068"><code class="literal">id</code></a></span></dt><dt><span class="section"><a href="#N110AA"><code class="literal">initcol</code></a></span></dt><dt><span class="section"><a href="#N11115"><code class="literal">log</code></a></span></dt><dt><span class="section"><a href="#N11131"><code class="literal">msg</code></a></span></dt><dt><span class="section"><a href="#N11151"><code class="literal">multiMatch</code></a></span></dt><dt><span class="section"><a href="#N1116D"><code class="literal">noauditlog</code></a></span></dt><dt><span class="section"><a href="#N1118D"><code class="literal">nolog</code></a></span></dt><dt><span class="section"><a href="#N111A9"><code class="literal">pass</code></a></span></dt><dt><span class="section"><a href="#N111C5"><code class="literal">pause</code></a></span></dt><dt><span class="section"><a href="#N111E1"><code class="literal">phase</code></a></span></dt><dt><span class="section"><a href="#N111FE"><code class="literal">proxy</code></a></span></dt><dt><span class="section"><a href="#N1121A"><code class="literal">redirect</code></a></span></dt><dt><span class="section"><a href="#N1123A"><code class="literal">rev</code></a></span></dt><dt><span class="section"><a href="#N1125B"><code class="literal">sanitiseArg</code></a></span></dt><dt><span class="section"><a href="#N11277"><code class="literal">sanitiseMatched</code></a></span></dt><dt><span class="section"><a href="#N11296"><code class="literal">sanitiseRequestHeader</code></a></span></dt><dt><span class="section"><a href="#N112B2"><code class="literal">sanitiseResponseHeader</code></a></span></dt><dt><span class="section"><a href="#N112CE"><code class="literal">severity</code></a></span></dt><dt><span class="section"><a href="#N11304"><code class="literal">setuid</code></a></span></dt><dt><span class="section"><a href="#N11329"><code class="literal">setsid</code></a></span></dt><dt><span class="section"><a href="#N11351"><code class="literal">setenv</code></a></span></dt><dt><span class="section"><a href="#N11375"><code class="literal">setvar</code></a></span></dt><dt><span class="section"><a href="#N1139C"><code class="literal">skip</code></a></span></dt><dt><span class="section"><a href="#N113BA"><code class="literal">status</code></a></span></dt><dt><span class="section"><a href="#N113DF"><code class="literal">t</code></a></span></dt><dt><span class="section"><a href="#N113FB"><code class="literal">xmlns</code></a></span></dt></dl></dd><dt><span class="section"><a href="#08-operators">Operators</a></span></dt><dd><dl><dt><span class="section"><a href="#N11418"><code class="literal">eq</code></a></span></dt><dt><span class="section"><a href="#N1142A"><code class="literal">ge</code></a></span></dt><dt><span class="section"><a href="#N1143C"><code class="literal">gt</code></a></span></dt><dt><span class="section"><a href="#N1144E"><code class="literal">inspectFile</code></a></span></dt><dt><span class="section"><a href="#N11460"><code class="literal">le</code></a></span></dt><dt><span class="section"><a href="#N11472"><code class="literal">lt</code></a></span></dt><dt><span class="section"><a href="#N11484"><code class="literal">rbl</code></a></span></dt><dt><span class="section"><a href="#N11496"><code class="literal">rx</code></a></span></dt><dt><span class="section"><a href="#N114D2"><code class="literal">validateByteRange</code></a></span></dt><dt><span class="section"><a href="#N114F6"><code class="literal">validateDTD</code></a></span></dt><dt><span class="section"><a href="#N11508"><code class="literal">validateSchema</code></a></span></dt><dt><span class="section"><a href="#N1151C"><code class="literal">validateUrlEncoding</code></a></span></dt><dt><span class="section"><a href="#N11534"><code class="literal">validateUtf8Encoding</code></a></span></dt></dl></dd></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="01-introduction"></a>Introduction</h2></div></div><div></div></div><p><span class="trademark">ModSecurity</span>&trade; is a web
    application firewall (WAF). With over 70% of all attacks now carried out
    over the web application level, organisations need every help they can get
    in making their systems secure. WAFs are deployed to establish an external
    security layer that increases security, detects, and prevents attacks
    before they reach web applications. It provides protection from a range of
    attacks against web applications and allows for HTTP traffic monitoring
    and real-time analysis with little or no changes to existing
    infrastructure.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1001D"></a>HTTP Traffic Logging</h3></div></div><div></div></div><p>Web servers are typically well-equipped to log traffic in a form
      useful for marketing analyses, but fall short when it comes to logging
      of traffic to web applications. In particular, most are not capable of
      logging the request bodies. Your adversaries know this, and that is why
      most attacks are now carried out via POST requests, rendering your
      systems blind. ModSecurity makes full HTTP transaction logging possible,
      allowing complete requests and responses to be logged. Its logging
      facilities also allow fine-grained decisions to be made about exactly
      what is logged and when, ensure only the relevant data is
      recorded.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10022"></a>Real-Time Monitoring and Attack Detection</h3></div></div><div></div></div><p>In addition to providing logging facilities, ModSecurity can
      monitor the HTTP traffic in real time in order to detect attacks. In
      this case ModSecurity operates as a web intrusion detection tool,
      allowing you to react to suspicious events that take place at your web
      systems.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10027"></a>Attack Prevention and Just-in-time Patching</h3></div></div><div></div></div><p>ModSecurity can also act immediately to prevent attacks from
      reaching your web applications. There are three commonly used
      approaches:</p><div class="orderedlist"><ol type="1"><li><p>Negative security model. Negative security model monitors
          requests for anomalies, unusual behaviour, and common web
          application attacks. It keeps anomaly scores for each request, IP
          addresses, application sessions, and user accounts. Requests with
          high anomaly scores are either logged or rejected altogether.</p></li><li><p>Positive security model. When positive security model is
          deployed, only requests that are known to be valid are accepted,
          with everything else rejected. This approach works best with
          applications that are heavily used but rarely updated.</p></li><li><p>Known weaknesses and vulnerabilities. Its rule language makes
          ModSecurity an ideal external patching tool. External patching is
          all about reducing the window of opportunity. Time needed to patch
          application vulnerabilities often runs to weeks in many
          organisations. With ModSecurity, applications can be patched from
          the outside, without touching the application source code (and even
          without any access to it), making your systems secure until a proper
          patch is produced.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10038"></a>Flexible Rule Engine</h3></div></div><div></div></div><p>A flexible rule engine sits in the heart of ModSecurity. It
      implements the ModSecurity Rule Language, which is a specialised
      programming language designed to work with HTTP transaction data. The
      ModSecurity Rule Language was designed to be easy to use, yet flexible:
      common operations are simple while complex operations are possible.
      Certified ModSecurity Rules, included with subscription to ModSecurity,
      contain a comprehensive set of rules that implement general-purpose
      hardening, common web application security issues. Heavily commented,
      these rules can be used as a learning tool.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1003D"></a>Embedded-mode Deployment</h3></div></div><div></div></div><p>ModSecurity is an embeddable web application firewall, which means
      it can be deployed as part of your existing web server infrastructure
      provided your web servers are Apache-based. This deployment method has
      certain advantages:</p><div class="orderedlist"><ol type="1"><li><p>No changes to existing network. It only takes a few minutes to
          add ModSecurity to your existing web servers. And because it was
          designed to be completely passive by default, you are free to deploy
          it incrementally and only use the features you need. It is equally
          easy to remove or deactivate it should decide you don't want it any
          more.</p></li><li><p>No single point of failure. Unlike with network-based
          deployments, you will not be introducing a new point of failure to
          your system.</p></li><li><p>Implicit load balancing and scaling. Because it works embedded
          in web servers, ModSecurity will automatically take advantage of the
          additional load balancing and scalability features. You will not
          need to think of load balancing and scaling unless your existing
          system needs them.</p></li><li><p>Minimal overhead. Because it works from inside the web server
          process there is no overhead for network communication and minimal
          overhead in parsing and data exchange.</p></li><li><p>No problem with encrypted or compressed content. Many IDS
          systems have difficulties analysing SSL traffic. This is not a
          problem for ModSecurity because it is positioned to work when the
          traffic is decrypted and decompressed.</p></li></ol></div><p>ModSecurity is known to work well on a wide range of operating
      systems. Our customers are successfully running it on Linux, Windows,
      Solaris, FreeBSD, OpenBSD, NetBSD, AIX, Mac OS X, and HP-UX.<span class="bold"><strong></strong></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10058"></a>Network-based Deployment</h3></div></div><div></div></div><p>ModSecurity works equally well when deployed as part of an
      Apache-based reverse proxy server, and many of our customers choose to
      do so. In this scenario, one installation of ModSecurity can protect any
      number of web servers (even the non-Apache ones).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="03-licensing"></a>Licensing</h3></div></div><div></div></div><p>ModSecurity is available under two licenses. Users can choose to
      use the software under the terms of the GNU General Public License
      version 2 (licence text is included with the distribution), as an Open
      Source / Free Software product. A range of commercial licenses is also
      available, together with a range of commercial support contracts. For
      more information on commercial licensing please contact Breach
      Security.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>ModSecurity, mod_security, and ModSecurity Pro are trademarks or
        registered trademarks of Breach Security, Inc.</p></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="N10066"></a>ModSecurity Core Rules</h2></div></div><div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10069"></a>Overview</h3></div></div><div></div></div><p>ModSecurity is a web application firewall engine that provides
      very little protection on its own. In order to become useful,
      ModSecurity must be configured with rules. In order to enable users to
      take full advantage of ModSecurity out of the box, Breach Security Inc.
      is providing a free certified rule set for ModSecurity 2.0. Unlike
      intrusion detection and prevention systems, which rely on signature
      specific to known vulnerabilities, the Core Rules provide generic
      protection from unknown vulnerabilities often found in web applications,
      which are in most cases custom coded. The Core Rules are heavily
      commented to allow it to be used as a step-by-step deployment guide for
      ModSecurity. The latest Core Rules can be found at the ModSecurity
      website - <a href="http://www.modsecurity.org/projects/rules/" target="_top">http://www.modsecurity.org/projects/rules/</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10072"></a>Core Rules Structure</h3></div></div><div></div></div><p>If you expect a single pack of Apache configuration files, you are
      right, and wrong. A ModSecurity rule set includes information about
      different areas:</p><div class="itemizedlist"><ul type="disc"><li><p>The logic required to detect attacks.</p></li><li><p>A policy setting the actions to perform if an attack is
          detected.</p></li><li><p>Information regarding attacks.</p></li></ul></div><p>In order to allow separate management of the different parts, the
      Core Rules are based on templates that are generated into a run-time
      rule set by inserting policy, patterns and event information. The Core
      Rules package includes these templates, the generation script (written
      in Perl) and data files required to generate a useful rule set. It also
      includes a bunch of pre-generated rule sets for different policies. The
      generation script also allows two optimizations:</p><div class="itemizedlist"><ul type="disc"><li><p>Optimal use of regular expressions. Since regular expressions
          are much more efficient if assembled into a single expression and
          optimized, the generation script takes the list of patterns that are
          required for a rule and optimize them into a most efficient regular
          expression.</p></li><li><p>Removal of rules that are not utilized by a specific
          policy.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1008A"></a>Core Rules Content</h3></div></div><div></div></div><p>In order to provide generic web applications protection, the Core
      Rules use the following techniques:</p><div class="itemizedlist"><ul type="disc"><li><p>HTTP protection - detecting violations of the HTTP protocol
          and a locally defined usage policy.</p></li><li><p>Common Web Attacks Protection - detecting common web
          application security attack.</p></li><li><p>Automation detection - Detecting bots, crawlers, scanners and
          other surface malicious activity.</p></li><li><p>Trojan Protection - Detecting access to Trojans horses.</p></li><li><p>Error Hiding - Disguising error messages sent by the
          server.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="02-installation"></a>Installation</h2></div></div><div></div></div><p>ModSecurity installation consists of the following steps:</p><div class="orderedlist"><ol type="1"><li><p>ModSecurity 2.x works with Apache 2.0.x or better.</p></li><li><p>Make sure you have <code class="literal">mod_unique_id</code> installed.</p></li><li><p>Install the latest version of libxml2, if it isn't already
        installed on the server.</p></li><li><p>Unpack the ModSecurity archive</p></li><li><p>Edit Makefile to configure the path to the Apache ServerRoot
        directory. You can check this by identifying the ServerRoot directive
        setting in your httpd.conf file. This is the path that was specified
        with the "--install-path=" configuration flag during compilation (for
        example, in Fedora Core4:<code class="filename"> top_dir =
        /etc/httpd</code>).</p></li><li><p>Edit Makefile to configure the correct include path for libxml
        (for example: <code class="filename">INCLUDES=-I/usr/include/libxml2</code>)</p></li><li><p>Compile with <code class="literal">make</code></p></li><li><p>Stop Apache</p></li><li><p>Install with<code class="literal"> make
        install</code></p></li><li><p>(Optional) Add one line to your configuration to load libxml2:
        <code class="filename">LoadFile
        /usr/lib/libxml2.so</code></p></li><li><p>Add one line to your configuration to load ModSecurity: <code class="literal">LoadModule security2_module
        modules/mod_security2.so</code></p></li><li><p>Configure ModSecurity</p></li><li><p>Start Apache</p></li><li><p>You now have ModSecurity 2.x up and running.</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you have compiled Apache yourself you might experience problems
      compiling ModSecurity against PCRE. This is because Apache bundles PCRE
      but this library is also typically provided by the operating system. I
      would expect most (all) vendor-packaged Apache distributions to be
      configured to use an external PCRE library (so this should not be a
      problem).</p><p>You want to avoid Apache using the bundled PCRE library and
      ModSecurity linking against the one provided by the operating system.
      The easiest way to do this is to compile Apache against the PCRE library
      provided by the operating system (or you can compile it against the
      latest PCRE version you downloaded from the main PCRE distribution
      site). You can do this at configure time using the<code class="literal"> --with-pcre</code> switch. If you are not in a
      position to recompile Apache then, to compile ModSecurity successfully,
      you'd still need to have access to the bundled PCRE headers (they are
      available only in the Apache source code) and change the include path
      for ModSecurity (as you did in step 7 above) to point to them.</p><p>Do note that if your Apache is using an external PCRE library you
      can compile ModSecurity with <code class="literal">WITH_PCRE_STUDY</code> defined,which would possibly
      give you a slight performance edge in regular expression
      processing.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="03-configuration-directives"></a>Configuration Directives</h2></div></div><div></div></div><p>The following section outlines all of the ModSecurity directives.
    Most of the ModSecurity directives can be used inside the various Apache
    Scope Directives such as <code class="literal">VirtualHost</code>,
    <code class="literal">Location</code>, <code class="literal">LocationMatch</code>,
    <code class="literal">Directory</code>, etc... There are others, however, that can
    only be used once in the main configuration file. This information is
    specified in the Scope sections below.</p><p>These rules, along with the Core rules files, should be contained is
    files outside of the httpd.conf file and called up with Apache "Include"
    directives. This allows for easier updating/migration of the rules. If you
    create your own custom rules that you would like to use with the Core
    rules, you should create a file called -
    <code class="filename">modsecurity_crs_15_customrules.conf</code> and place it in
    the same directory as the Core rules files. By using this file name, your
    custom rules will be called up after the standard ModSecurity Core rules
    configuration file but before the other Core rules. This allows your rules
    to be evaluate first which can be useful if you need to implement specific
    "allow" rules or to correct any false positives in the Core rules as they
    are applied to your site.</p><p><span class="bold"><strong>Note</strong></span></p><p>It is highly encouraged that you do not edit the Core rules files
    themselves but rather place all changes (such as
    <code class="literal">SecRuleRemoveByID</code>, etc...) in your custom rules file.
    This will allow for easier upgrading as newer Core rules are released by
    Breach Security on the ModSecurity website.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10119"></a><code class="literal">SecAction</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Unconditionally
      processes the action list it receives as the first and only parameter.
      It accepts one parameter, the syntax of which is identical to the third
      parameter of<code class="literal"> SecRule</code>.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAction action1,action2,action2</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAction
      nolog,redirect:http://www.hostname.com</code></p><p><span class="bold"><strong>ProcessingPhase:</strong></span> Any</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> None</p><p>SecAction is best used when you uncondiationally execute an
      action. This is explicit triggering whereas the normal Actions are
      conditional based on data inspection of the request/response. This is a
      useful directive when you want to run certian actions such as initcol to
      initialize collections.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10147"></a><code class="literal">SecArgumentSeparator</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Specifies which
      character to use as separator for<code class="literal">
      application/x-www-form-urlencoded</code> content. Defaults to
      <code class="literal">&amp;</code>. Applications are sometimes
      (very rarely) written to use a semicolon (<code class="literal">;</code>).</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecArgumentSeparator character</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecArgumentSeparator ;</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> Any</p><p><span class="bold"><strong> <span class="bold"><strong>Scope:</strong></span>
      </strong></span> Main</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> None</p><p>This directive is needed if a backend web appliaction is using a
      non-standard argument separator. If this directive is not set properly
      for each web app, then ModSecurity will not be able to parse the
      arguements appropriately and the effectiveness of the rule matching will
      be significantly decreased.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10181"></a><code class="literal">SecAuditEngine</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the audit
      logging engine.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAuditEngine On|Off|RelevantOnly</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAuditEngine On</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Can be
      set/changed with the "ctl" action for the current transaction.</p><p>Example: The following example shows the various audit directives
      used together.</p><pre class="programlisting"><span class="bold"><strong>SecAuditEngine RelevantOnly</strong></span> 
SecAuditLog logs/audit/audit.log
SecAuditLogParts ABCFHZ
SecAuditLogType concurrent
SecAuditLogStorageDir logs/audit
<span class="bold"><strong>SecAuditLogRelevantStatus ^[45]</strong></span></pre><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">On</code> - log all transactions
          by default.</p></li><li><p><code class="literal">Off</code> - do not log
          transactions by default.</p></li><li><p><code class="literal">RelevantOnly</code> - by default
          only log transactions that have triggered a warning or an error, or
          have a status code that is considered to be relevant (see<code class="literal"> SecAuditLogRelevantStatus</code>).</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N101CD"></a><code class="literal">SecAuditLog</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Defines the path to
      the main audit log file.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAuditLog /path/to/auditlog</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAuditLog
      /usr/local/apache/logs/audit.log</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> This file is
      open on startup when the server typically still runs as<span class="emphasis"><em>
      root</em></span>. You should not allow non-root users to have write
      privileges for this file or for the directory it is stored in..</p><p>This file will be used to store the audit log entries if serial
      audit logging format is used. If concurrent audit logging format is used
      this file will be used as an index, and contain a record of all audit
      log files created. If you are planning to use Concurrent audit logging
      and sending your audit log data off to a remote Console host, then you
      will need to use the modsec-auditlog-collector.pl script and use the
      following format:</p><p><pre class="programlisting">SecAuditLog \
  "|/path/modsec-auditlog-collector.pl /path/SecAuditLogDataDir /path/SecAuditLog"</pre></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N101FE"></a><code class="literal">SecAuditLog2</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Defines the path to
      the secondary audit log index file when concurrent logging is enabled.
      See <code class="literal">SecAuditLog2</code> for more
      details.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAuditLog2 /path/to/auditlog2</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAuditLog2
      /usr/local/apache/logs/audit2.log</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> A main audit
      log must be defined via <code class="literal">SecAuditLog</code>
      before this directive may be used. Additionally, this log is only used
      for replicating the main audit log index file when concurrent audit
      logging is used. It will <span class="bold"><strong>not</strong></span> be used
      for non-concurrent audit logging.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10232"></a><code class="literal">SecAuditLogParts</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Defines the path to
      the main audit log file.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAuditLogParts PARTS</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAuditLogParts ABCFHZ</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong> <span class="bold"><strong>Scope:</strong></span>
      </strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> At this time
      ModSecurity does not log response bodies of stock Apache responses (e.g.
      <code class="literal">404</code>), or the <code class="literal">Server</code> and <code class="literal">Date</code> response headers.</p><p>Default:<code class="literal"> ABCFHZ</code>.</p><p>Available audit log parts:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">A</code> - audit log header
          (mandatory)</p></li><li><p><code class="literal">B</code> - request
          headers</p></li><li><p><code class="literal">C</code> - request body (present
          only if the request body exists and ModSecurity is configured to
          intercept it)</p></li><li><p><code class="literal">D</code> - RESERVED for
          intermediary response headers, not implemented yet.</p></li><li><p><code class="literal">E</code> - intermediary response
          body (present only if ModSecurity is configured to intercept
          response bodies, and if the audit log engine is configured to record
          it). Intermediary response body is the same as the actual response
          body unless ModSecurity intercepts the intermediary response body,
          in which case the actual response body will contain the error
          message (either the Apache default error message, or the
          ErrorDocument page).</p></li><li><p><code class="literal">F</code> - final response
          headers (excluding the Date and Server headers, which are always
          added by Apache in the late stage of content delivery).</p></li><li><p><code class="literal">G</code> - RESERVED for the
          actual response body, not implemented yet.</p></li><li><p><code class="literal">H</code> - audit log
          trailer</p></li><li><p><code class="literal">I</code> - This part is a
          replacement for part C. It will log the same data as C in all cases
          except when<code class="literal">multipart/form-data</code>
          encoding in used. In this case it will log a fake <code class="literal"> application/x-www-form-urlencoded</code> body
          that contains the information about parameters but not about the
          files. This is handy if you don't want to have (often large) files
          stored in your audit logs.</p></li><li><p><code class="literal">J</code> - RESERVED. This part,
          when implemented, will contain information about the files uploaded
          using multipart/form-data encoding.</p></li><li><p><code class="literal">Z</code> - final boundary,
          signifies the end of the entry (mandatory)</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N102BD"></a><code class="literal">SecAuditLogRelevantStatus</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures which
      response status code is to be considered relevant for the purpose of
      audit logging.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAuditLogRelevantStatus REGEX</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAuditLogRelevantStatus ^[45]</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Must have the
      SecAuditEngine set to RelevantOnly. The parameter is a regular
      expression.</p><p>The main purpose of this directive is to allow you to configure
      audit logging for only transactions that generate the specified HTTP
      Response Status Code. This directive is often used to the decrease the
      total size of the audit log file. Keep in mind that if this parameter is
      used, then successful attacks that result in a 200 OK status code will
      not be logged.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N102E7"></a><code class="literal">SecAuditLogStorageDir</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      storage directory where concurrent audit log entries are to be
      stored.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAuditLogStorageDir
      /path/to/storage/dir</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAuditLogStorageDir
      /usr/local/apache/logs/audit</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span>
      SecAuditLogType must be set to Concurrent. The directory must already be
      created before starting Apache and it must be writable by the web server
      user as new files are generated at runtime.</p><p>As with all logging mechanisms, ensure that you specify a file
      system location that has adequate disk space and is not on the root
      partition.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10311"></a><code class="literal">SecAuditLogType</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the type
      of audit logging mechanism to be used.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecAuditLogType Serial|Concurrent</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecAuditLogType Serial</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Must specify
      SecAuditLogStorageDir if you use concurrent logging.</p><p>Possible values are:</p><div class="orderedlist"><ol type="1"><li><p><code class="literal">Serial</code> - all audit log
          entries will be stored in the main audit logging file. This is more
          convenient for casual use but it is slower as only one audit log
          entry can be written to the file at any one file.</p></li><li><p><code class="literal">Concurrent</code> - audit log
          entries will be stored in separate files, one for each transaction.
          Concurrent logging is the mode to use if you are going to send the
          audit log data off to a remote ModSecurity Console host.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1034A"></a><code class="literal">SecChrootDir</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      directory path that will be used to jail the web server process.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecChrootDir /path/to/chroot/dir</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecChrootDir /chroot</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Main</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> The internal
      chroot functionality provided by ModSecurity works great for simple
      setups. One example of a simple setup is Apache serving static files
      only, or running scripts using modules. For more complex setups you
      should consider building a jail the old-fashioned way. The internal
      chroot feature should be treated as somewhat experimental. Due to the
      large number of default and third-party modules available for the Apache
      web server, it is not possible to verify the internal chroot works
      reliably with all of them. You are advised to think about your option
      and make your own decision. In particular, if you are using any of the
      modules that fork in the module initialisation phase (e.g. mod_fastcgi,
      mod_fcgid, mod_cgid), you are advised to examine each Apache process and
      observe its current working directory, process root, and the list of
      open files.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10372"></a><code class="literal">SecCookieFormat</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Selects the cookie
      format that will be used in the current configuration context.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecCookieFormat 0|1</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecCookieFormat 0</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> None</p><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">0</code> - use version 0
          (Netscape) cookies. This is what most applications use. It is the
          default value.</p></li><li><p><code class="literal">1</code> - use version 1
          cookies.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N103A9"></a><code class="literal">SecDataDir</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Path where
      persistent data (e.g. IP address data, session data, etc) is to be
      stored.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecDataDir /path/to/dir</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecDataDir /usr/local/apache/logs/data</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong> <span class="bold"><strong>Scope:</strong></span>
      </strong></span> Main</p><p><span class="bold"><strong>Dependencies/Notes: </strong></span> This
      directive is needed when initcol, setsid an setuid are used. Must be
      writable by the web server user.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N103D5"></a><code class="literal">SecDebugLog</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Path to the
      ModSecurity debug log file.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecDebugLog /path/to/modsec-debug.log</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecDebugLog
      /usr/local/apache/logs/modsec-debug.log</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> None</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N103FD"></a><code class="literal">SecDebugLogLevel</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      verboseness of the debug log data.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecDebugLogLevel 0|1|2|3|4|5|6|7|8|9</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecDebugLogLevel 4</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Levels
      <code class="literal">1 - 3</code> are always sent to the Apache
      error log. Therefore you can always use level <code class="literal">0</code> as the default logging level in production.
      Level <code class="literal">5</code> is useful when debugging. It
      is not advisable to use higher logging levels in production as excessive
      logging can slow down server significantly.</p><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">0</code> - no logging.</p></li><li><p><code class="literal">1</code> - errors (intercepted
          requests) only.</p></li><li><p><code class="literal">2</code> - warnings.</p></li><li><p><code class="literal">3</code> - notices.</p></li><li><p><code class="literal">4</code> - details of how
          transactions are handled.</p></li><li><p><code class="literal">5</code> - as above, but including
          information about each piece of information handled.</p></li><li><p><code class="literal">9</code> - log everything,
          including very detailed debugging information.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1045E"></a><code class="literal">SecDefaultAction</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Defines the default
      action to take on a rule match.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecDefaultAction
      action1,action2,action3</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecDefaultAction
      log,auditlog,deny,status:403,phase:2,t:lowercase</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> Any</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Rules
      following a SecDefaultAction directive will inherit this setting unless
      a specific action is specified for an indivdual rule or until another
      SecDefaultAction is specified.</p><p>The default value is:</p><pre class="programlisting">SecDefaultAction log,auditlog,deny,status:403,phase:2,t:none</pre><p><span class="bold"><strong>Note</strong></span></p><p>SecDefaultAction must specify a disruptive action and a processing
      phase.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10491"></a><code class="literal">SecGuardianLog</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configuration
      directive to use the httpd-guardian script to monitor for Denial of
      Service (DoS) attacks.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecGuardianLog |/path/to/httpd-guardian</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecGuardianLog
      |/usr/local/apache/bin/httpd-guardian</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Main</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> By default
      httpd-guardian will defend against clients that send more 120 requests
      in a minute, or more than 360 requests in five minutes.</p><p>Since 1.9, ModSecurity supports a new directive, SecGuardianLog,
      that is designed to send all access data to another program using the
      piped logging feature. Since Apache is typically deployed in a
      multi-process fashion, making information sharing difficult, the idea is
      to deploy a single external process to observe all requests in a
      stateful manner, providing additional protection.</p><p>Development of a state of the art external protection tool will be
      a focus of subsequent ModSecurity releases. However, a fully functional
      tool is already available as part of the <a href="http://www.apachesecurity.net/tools/" target="_top">Apache httpd tools
      project</a>. The tool is called httpd-guardian and can be used to
      defend against Denial of Service attacks. It uses the blacklist tool
      (from the same project) to interact with an iptables-based (Linux) or
      pf-based (*BSD) firewall, dynamically blacklisting the offending IP
      addresses. It can also interact with SnortSam (http://www.snortsam.net).
      Assuming httpd-guardian is already configured (look into the source code
      for the detailed instructions) you only need to add one line to your
      Apache configuration to deploy it:</p><pre class="programlisting">SecGuardianLog |/path/to/httpd-guardian</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N104C5"></a><code class="literal">SecRequestBodyAccess</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures whether
      request bodies will be buffered and processed by ModSecurity by
      default.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRequestBodyAccess On|Off</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRequestBodyAccess On</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> This
      directive is required if you plan to inspect POST_PAYLOADS of requests.
      This directive must be used along with the "phase:2" processing phase
      action and REQUEST_BODY variable/location. If any of these 3 parts are
      not configured, you will not be able to inspect the request
      bodies.</p><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">On</code> - access request
          bodies.</p></li><li><p><code class="literal">Off</code> - do not attempt to
          access request bodies.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N104FC"></a><code class="literal">SecRequestBodyLimit</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      maximum request body size ModSecurity will accept for buffering.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRequestBodyLimit NUMBER_IN_BYTES</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRequestBodyLimit 134217728</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> 131072 KB
      (134217728 bytes) is the default setting. Anything over this limit will
      be rejected with status code 413 Request Entity Too Large. There is a
      hard limit of 1 GB.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10524"></a><code class="literal">SecRequestBodyInMemoryLimit</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      maximum request body size ModSecurity will store in memory.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRequestBodyInMemoryLimit
      NUMBER_IN_BYTES</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRequestBodyInMemoryLimit 131072</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> None</p><p>By default the limit is 128 KB:</p><pre class="programlisting"># Store up to 128 KB in memory
SecRequestBodyInMemoryLimit 131072</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10551"></a><code class="literal">SecResponseBodyLimit</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      maximum response body size that will be accepted for buffering.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecResponseBodyLimit NUMBER_IN_BYTES</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecResponseBodyLimit 524228</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Anything over
      this limit will be rejected with status code 500 Internal Server Error.
      This setting will not affect the responses with MIME types that are not
      marked for buffering. There is a hard limit of 1 GB.</p><p>By default this limit is configured to 512 KB:</p><pre class="programlisting"># Buffer response bodies of up to 512 KB in length 
SecResponseBodyLimit 524288</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1057E"></a><code class="literal">SecResponseBodyMimeType</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures
      which<code class="literal"> MIME</code> types are to be considered
      for response body buffering.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecResponseBodyMimeType mime/type</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecResponseBodyMimeType text/plain
      text/html</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span>
      Multiple<code class="literal"> SecResponseBodyMimeType</code>
      directives can be used to add<code class="literal"> MIME</code>
      types.</p><p>The default value is <code class="literal">text/plaintext/html</code>:</p><pre class="programlisting">SecResponseBodyMimeType text/plain text/html</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N105BB"></a><code class="literal">SecResponseBodyMimeTypesClear</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Clears the list of
      <code class="literal">MIME</code> types considered for response
      body buffering, allowing you to start populating the list from
      scratch.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecResponseBodyMimeTypesClear</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecResponseBodyMimeTypesClear</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> None</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N105E7"></a><code class="literal">SecResponseBodyAccess</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures whether
      response bodies are to be buffer and analysed or not.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecResponseBodyAccess On|Off</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecResponseBodyAccess On</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> This
      directive is required if you plan to inspect html responses. This
      directive must be used along with the "phase:4" processing phase action
      and RESPONSE_BODY variable/location. If any of these 3 parts are not
      configured, you will not be able to inspect the response bodies.</p><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">On</code> - access response bodies
          (but only if the MIME type matches, see above).</p></li><li><p><code class="literal">Off</code> - do not attempt to
          access response bodies.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1061E"></a><code class="literal">SecRule</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> <code class="literal">SecRule</code> is the main ModSecurity directive. It
      is used to analyse data and perform actions based on the results.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRule VARIABLES OPERATOR [ACTIONS]</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRule REQUEST_URI "attack"</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> Any</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> None</p><p>In general, the format of this rule is as follows:</p><pre class="programlisting">SecRule VARIABLES OPERATOR [ACTIONS]</pre><p>The second part, <code class="literal">OPERATOR</code>,
      specifies how they are going to be checked. The third (optional) part,
      <code class="literal">ACTIONS</code>, specifies what to do
      whenever the operator used performs a successful match against a
      variable.</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10659"></a>Variables in rules</h4></div></div><div></div></div><p>The first part,<code class="literal"> VARIABLES</code>,
        specifies which variables are to be checked. For example, the
        following rule will reject a transaction that has the word<span class="emphasis"><em>
        dirty</em></span> in the URI:</p><pre class="programlisting">SecRule REQUEST_URI dirty</pre><p>Each rule can specify one or more variables:</p><pre class="programlisting">SecRule REQUEST_URI|QUERY_STRING dirty</pre><p>There is a third format supported by the selection operator -
        XPath expression. XPath expressions can only used against the special
        variable XML, which is available only of the request body was
        processed as XML.</p><pre class="programlisting">SecRule XML:/xPath/Expression dirty</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>As you have just seen, not all collections support all
          selection operator format types. You should refer to the
          documentation of each collection to determine what is and isn't
          supported.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N10675"></a>Operators in rules</h4></div></div><div></div></div><p>In the simplest possible case you will use a regular expression
        pattern as the second rule parameter. This is what we've done in the
        examples above. If you do this ModSecurity assumes you want to use the
        <code class="literal">rx</code> operator. You can explicitly
        specify the operator you want to use by using <code class="literal">@</code> as the first character in the second rule
        parameter:</p><pre class="programlisting">SecRule REQUEST_URI "@rx dirty"</pre><p>Note how we had to use double quotes to delimit the second rule
        parameter. This is because the second parameter now has a whitespace
        in it. Any number of whitespace characters can follow the name of the
        operator. If there are any non-whitespace characters there, they will
        all be treated as a special parameter to the operator. In the case of
        the regular expression operator the special parameter is the pattern
        that will be used for comparison.</p><p>The @ can be the second character if you are using negation to
        negate the result returned by the operator:</p><pre class="programlisting">SecRule &amp;ARGS "!@rx ^0$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="N1068C"></a>Actions in rules</h4></div></div><div></div></div><p>The third parameter, <code class="literal">ACTIONS</code>,
        can be omitted only because there is a helper feature that specifies
        the default action list. If the parameter isn't omitted the actions
        specified in the parameter will be merged with the default action list
        to create the actual list of actions that will be processed on a rule
        match.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10695"></a><code class="literal">SecRuleInheritance</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures whether
      the current context will inherit rules from the parent context
      (configuration options are inherited in most cases - you should look up
      the documentation for every directive to determine if it is inherited or
      not).</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRuleInheritance On|Off</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRuleInheritance Off</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> Any</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span>
      Resource-specific contexts (e.g.<code class="literal">
      Location</code>, <code class="literal">Directory</code>, etc)
      cannot override <span class="emphasis"><em>phase1</em></span> rules configured in the main
      server or in the virtual server. This is because phase 1 is run early in
      the request processing process, before Apache maps request to resource.
      Virtual host context can override phase 1 rules configured in the main
      server.</p><p>Example: The following example shows where ModSecurity may be
      enabled in the main Apache configuration scope, however you might want
      to configure your VirtualHosts differently. In the first example, the
      first virtualhost is not inheriting the ModSecurity main config
      directives and in the second one it is.</p><pre class="programlisting">SecRuleEnine On
SecDefaultAction log,pass,phase:2
...  

&lt;VirtualHost *:80&gt;
ServerName app1.com 
ServerAlias www.app1.com<span class="bold"><strong>
SecRuleInheritance Off</strong></span>
SecDefaultAction log,deny,phase:1,redirect:http://www.site2.com 
... 
&lt;/VirtualHost&gt;  

&lt;VirtualHost *:80&gt; 
ServerName app2.com 
ServerAlias www.app2.com
<span class="bold"><strong>SecRuleInheritance On</strong></span> SecRule ARGS "attack" 
... 
&lt;/VirtualHost&gt;</pre><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">On</code> - inherit rules from the
          parent context.</p></li><li><p><code class="literal">Off</code> - do not inherit rules
          from the parent context.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N106E4"></a><code class="literal">SecRuleEngine</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the rules
      engine.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRuleEngine On|Off|DetectionOnly</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRuleEngine On</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> Any</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Thisdirective
      can also be controled by the ctl action (ctl:ruleEngine=off) for per
      rule processing.</p><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">On</code> - process rules.</p></li><li><p><code class="literal">Off</code> - do not process
          rules.</p></li><li><p><code class="literal">DetectionOnly</code> - process
          rules but never intercept transactions, even when rules are
          configured to do so.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10721"></a><code class="literal">SecRuleRemoveById</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Removes matching
      rules from the parent contexts.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRuleRemoveById RULEID</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRuleRemoveByID 1 2 "9000-9010"</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> Any</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> This
      directive supports multiple parameters, where each parameter can either
      be a rule ID, or a range. Parameters that contain spaces must be
      delimited using double quotes.</p><pre class="programlisting">SecRuleRemoveById 1 2 5 10-20 "400-556" 673</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1074C"></a><code class="literal">SecRuleRemoveByMsg</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Removes matching
      rules from the parent contexts.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecRuleRemoveByMsg REGEX</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecRuleRemoveByMsg "FAIL"</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> Any</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> This
      directive supports multiple parameters. Each parameter is a regular
      expression that will be applied to the message (specified using the
      <code class="literal">msg</code> action).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10778"></a><code class="literal">SecServerSignature</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Instructs
      ModSecurity to change the data presented in the "Server:" response
      header token.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecServerSignature "WEB SERVER
      SOFTWARE"</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecServerSignature
      "Netscape-Enterprise/6.0"</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Main</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> In order for
      this directive to work, you must set the Apache ServerTokens directive
      to Full. ModSecurity will overwrite the server signature data held in
      this memory space with the data set in this directive. If ServerTokens
      is not set to Full, then the memory space is most likely not large
      enough to hold the new data we are looking to insert.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N107A0"></a><code class="literal">SecTmpDir</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      directory where temporary files will be created.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecTmpDir /path/to/dir</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecTmpDir /tmp</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Needs to be
      writable by the Apache user process. This is the directory location
      where Apache will swap data to disk if it runs out of memory (more data
      than what was specified in the SecRequestBodyInMemoryLimit directive)
      during inspection.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N107C8"></a><code class="literal">SecUploadDir</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures the
      directory where intercepted files will be stored.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecUploadDir /path/to/dir</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecUploadDir /tmp</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> This
      directory must be on the same filesystem as the temporary directory
      defined with <code class="literal">SecTmpDir</code>. This
      directive is used with <code class="literal">SecUploadKeepFiles</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N107F7"></a><code class="literal">SecUploadKeepFiles</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configures whether
      or not the intercepted files will be kept after transaction is
      processed.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecUploadKeepFiles On|Off|RelevantOnly</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecUploadKeepFiles On</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> This
      directive requires the storage directory to be defined (using <code class="literal">SecUploadDir</code>).</p><p>Possible values are:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">On</code> - Keep uploaded
          files.</p></li><li><p><code class="literal">Off</code> - Do not keep uploaded
          files.</p></li><li><p><code class="literal">RelevantOnly</code> - This will
          keep only those files that belong to requests that are deemed
          relevant.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10838"></a><code class="literal">SecWebAppId</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Creates a partition
      on the server that belongs to one web application.</p><p><span class="bold"><strong>Syntax:</strong></span> <code class="literal">SecWebAppId "NAME"</code></p><p><span class="bold"><strong>Example Usage:</strong></span> <code class="literal">SecWebAppId "WebApp1"</code></p><p><span class="bold"><strong>Processing Phase:</strong></span> N/A</p><p><span class="bold"><strong>Scope:</strong></span> Any</p><p><span class="bold"><strong>Dependencies/Notes:</strong></span> Partitions
      are used to avoid collisions between session IDs and user IDs. This
      directive must be used if there are multiple applications deployed on
      the same server. If it isn't used, a collision between session IDs might
      occur. The default value is<code class="literal"> default</code>.
      Example:</p><pre class="programlisting">&lt;VirtualHost *:80&gt; 
ServerName app1.com 
ServerAlias www.app1.com
<span class="bold"><strong>SecWebAppId "App1"</strong></span>
SecRule REQUEST_COOKIES:PHPSESSID !^$ chain,nolog,pass 
SecAction setsid:%{REQUEST_COOKIES.PHPSESSID} 
... 
&lt;/VirtualHost&gt;  

&lt;VirtualHost *:80&gt; 
ServerName app2.com 
ServerAlias www.app2.com<span class="bold"><strong>
SecWebAppId "App2"</strong></span>
SecRule REQUEST_COOKIES:PHPSESSID !^$ chain,nolog,pass 
SecAction setsid:%{REQUEST_COOKIES.PHPSESSID} 
... 
&lt;/VirtualHost&gt;</pre><p>In the two examples configurations shown, SecWebAppId is being
      used in conjuction with the Apache VirtualHost directives. What this
      achieves is to create more unique collection names when being hosted on
      one server. Normally, when setsid is used, ModSecurity will create a
      collection with the name "SESSION" and it will hold the value specified.
      With using SecWebAppId as shown in the examples, however, the name of
      the collection would become "App1_SESSION" and "App2_SESSION".</p><p>SecWebAppId is relevant in two cases:</p><div class="orderedlist"><ol type="1"><li><p>You are logging transactions/alerts to the ModSecurity Console
          and you want to use the web application ID to search only the
          transactions belonging to that application.</p></li><li><p>You are using the data persistence facility (collections
          SESSION and USER) and you need to avoid collisions between sessions
          and users belonging to different applications.</p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="04-processing-phases"></a>Processing Phases</h2></div></div><div></div></div><p>ModSecurity 2.x allows rules to be placed in one of the following
    five phases:</p><div class="orderedlist"><ol type="1"><li><p>Request headers</p></li><li><p>Request body</p></li><li><p>Response headers</p></li><li><p>Response body</p></li><li><p>Logging</p></li></ol></div><p><span class="bold"><strong>ModSecurity Processing Phases
    Diagram</strong></span></p><p><span class="emphasis"><em> <span class="emphasis"><em>Below is a diagram of the standard Apache
    Request Cycle. In the diagram, the 5 ModSecurity processing phases are
    shown.</em></span> </em></span></p><p><div><img src="apache_request_cycle-modsecurity.jpg" width="810"></div></p><p>In order to select the phase a rule executes during, use the phase
    action either directly in the rule or in using the
    <code class="literal">SecDefaultAction</code> directive:</p><pre class="programlisting">SecDefaultAction "log,pass,<span class="bold"><strong>phase:2</strong></span>"
SecRule REQUEST_HEADERS:Host "!^$" "deny,<span class="bold"><strong>phase:1</strong></span>"</pre><p><span class="bold"><strong>Note on Rule and Phases</strong></span></p><p>Keep in mind that rules are executed according to phases, so even if
    two rules are adjacent in a configuration file, but are set to execute in
    different phases, they would not happen one after the other. The order of
    rules in the configuration file is important only within the rules of each
    phase. This is especially important when using the <code class="literal">skip</code>
    action.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N108BC"></a>Phase Request Headers</h3></div></div><div></div></div><p>Rules in this phase are processed immediately after Apache
      completes reading the request headers (post-read-request phase). At this
      point the request body has not been read yet, meaning not all request
      arguments are available. Rules should be placed in this phase if you
      need to have them run early (before Apache does something with the
      request), to do something before the request body has been read,
      determine whether or not the request body should be buffered, or decide
      how you want the request body to be processed (e.g. whether to parse it
      as XML or not).</p><p><span class="bold"><strong>Note</strong></span></p><p>Rules in this phase can not leverage Apache scope directives
      (Directory, Location, LocationMatch, etc...) as the post-read-request
      hook does not have this information yet. The exception here is the
      VirtualHost directive. If you want to use ModSecurity rules inside
      Apache locations, then they should run in Phase 2. Refer to the Apache
      Request Cycle/ModSecurity Processing Phases diagram.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N108C7"></a>Phase Request Body</h3></div></div><div></div></div><p>This is the general-purpose input analysis phase. Most of the
      application-oriented rules should go here. In this phase you are
      guaranteed to have received the request argument (provided the request
      body has been read). ModSecurity supports three encoding types for the
      request body phase:</p><div class="itemizedlist"><ul type="disc"><li><p>application/x-www-form-urlencoded - used to transfer form
          data</p></li><li><p>multipart/form-data - used for file transfers</p></li><li><p>text/xml - used for passing XML data</p></li></ul></div><p>Other encodings are not used by most web applications.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N108D8"></a>Phase Response Headers</h3></div></div><div></div></div><p>This phase takes place just before response headers are sent back
      to the client. Run here if you want to observe the response before that
      happens, and if you want to use the response headers to determine if you
      want to buffer the response body. Note that some response status codes
      (such as 404) are handled earlier in the request cycle by Apache and my
      not be able to be triggered as expected. Additionally, there are some
      response headers that are added by Apache at a later hook (such as Date,
      Server and Connection) that we would not be able to trigger on or
      sanitize. This should work appropirately in a proxy setup or within
      phase:5 (logging).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N108DD"></a>Phase Response Body</h3></div></div><div></div></div><p>This is the general-purpose output analysis phase. At this point
      you can run rules against the response body (provided it was buffered,
      of course). This is the phase where you would want to inspect the
      outbound html for information discloure, error messages or failed
      authentication text.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N108E2"></a>Phase Logging</h3></div></div><div></div></div><p>This phase is run just before logging takes place. The rules
      placed into this phase can only affect how the logging is performed.
      This phase can be used to inspect the error messages logged by Apache.
      You can not deny/block connections in this phase as it is too late. This
      phase also allows for inspection of other response headers that weren't
      available during phase:3 or phase:4.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="05-variables"></a>Variables</h2></div></div><div></div></div><p>The following variables are supported in ModSecurity 2.x:</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N108ED"></a><code class="literal">ARGS</code></h3></div></div><div></div></div><p><code class="literal">ARGS</code> is a collection and can be used on its own
      (means all arguments including the POST Payload), with a static
      parameter (matches arguments with that name), or with a regular
      expression (matches all arguments with name that matches the regular
      expression). Note: <code class="literal">ARGS:p</code> will not result in any
      invocations against the operator if argument p does not exist. Some
      variables are actually collections, which are expanded into more
      variables at runtime. The following example will examine all request
      arguments:<pre class="programlisting">SecRule ARGS dirty</pre>
      Sometimes, however, you will want to look only at parts of a collection.
      This can be achieved with the help of the <span class="emphasis"><em>selection
      operator</em></span>(colon). The following example will only look at the
      arguments named<code class="literal"> p</code> (do note that, in
      general, requests can contain multiple arguments with the same name):
      <pre class="programlisting">SecRule ARGS:p dirty</pre>
      It is also possible to specify exclusions. The following will examine
      all request arguments for the word<span class="emphasis"><em> dirty</em></span>, except
      the ones named <code class="literal">z</code> (again, there can be
      zero or more arguments named<code class="literal"> z</code>):
      <pre class="programlisting">SecRule ARGS|!ARGS:z dirty</pre>
      There is a special operator that allows you to count how many variables
      there are in a collection. The following rule will trigger if there is
      more than zero arguments in the request (ignore the second parameter for
      the time being): <pre class="programlisting">SecRule &amp;ARGS !^0$</pre>
      And sometimes you need to look at an array of parameters, each with a
      slightly different name. In this case you can specify a regular
      expression in the selection operator itself. The following rule will
      look into all arguments whose names begin with <code class="literal">id_</code>: <pre class="programlisting">SecRule ARGS:/^id_/ dirty</pre></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>In ModSecurity 1.X, the <code class="literal">ARGS</code> variable stood
        for <code class="literal">QUERY_STRING</code> + <code class="literal">POST_PAYLOAD</code>,
        whereas now it expands to to individual variables.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1092E"></a><code class="literal">ARGS_COMBINED_SIZE</code></h3></div></div><div></div></div><p>This variable allows you to set more targeted evaluations on the
      total size of the Arguments as compared with normal Apache LimitRequest
      directives. For example, you could create a rule to ensure that the
      total size of the argument data is below a certain threshold (to help
      prevent buffer overflow issues). Example: Block request if the size of
      the arguments is above 25 characters.</p><pre class="programlisting">SecRule REQUEST_FILENAME "^/cgi-bin/login\.php$" "chain,log,deny,phase:2"
SecRule <span class="bold"><strong>ARGS_COMBINED_SIZE</strong></span> "@gt 25"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1093C"></a><code class="literal">ARGS_NAMES</code></h3></div></div><div></div></div><p>Is a collection of the argument names. You can search for specific
      argument names that you want to block. In a positive policy scenario,
      you can also whitelist (using an inverted rule with the ! character)
      only authorized argument names. Example: This example rule will only
      allow 2 argument names - p and a. If any other argument names are
      injected, it will be blocked.</p><pre class="programlisting">SecRule REQUEST_FILENAME "/index.php" "chain,log,deny,status:403,phase:2"
SecRule<span class="bold"><strong> ARGS_NAMES</strong></span> "!^(p|a)$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1094A"></a><code class="literal">AUTH_TYPE</code></h3></div></div><div></div></div><p>This variable holds the authentication method used to validate a
      user. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>AUTH_TYPE</strong></span> "basic" log,deny,status:403,phase:1,t:lowercase</pre><p><span class="bold"><strong>Note</strong></span></p><p>This data will not be available in a proxy-mode deployment as the
      authentication is not local. In a proxy-mode deployment, you would need
      to inpect the <code class="literal">REQUEST_HEADERS:Authorization</code>
      header.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10961"></a><code class="literal">ENV</code></h3></div></div><div></div></div><p>Collection, requires a single parameter (after a colon character).
      The ENV variable is set with setenv and does not give access to the CGI
      environment variables. Example:</p><pre class="programlisting">SecRule REQUEST_FILENAME "printenv" pass,<span class="bold"><strong>setenv:tag=suspicious</strong></span>
SecRule <span class="bold"><strong>ENV:tag</strong></span> "suspicious"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10973"></a><code class="literal">FILES</code></h3></div></div><div></div></div><p>Collection. Contains a collection of original file names (as they
      were called on the remote user's file system). Note: only available if
      files were extracted from the request body. Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> FILES</strong></span> "\.conf$" log,deny,status:403,phase:2</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10981"></a><code class="literal">FILES_COMBINED_SIZE</code></h3></div></div><div></div></div><p>Single value. Total size of the uploaded files. Note: only
      available if files were extracted from the request body. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>FILES_COMBINED_SIZE</strong></span> "@gt 1000" log,deny,status:403,phase:2</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1098F"></a><code class="literal">FILES_NAMES</code></h3></div></div><div></div></div><p>Collection w/o parameter. Contains a list of form fields that were
      used for file upload. Note: only available if files were extracted from
      the request body. Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> FILES_NAMES</strong></span> "^upfile$" log,deny,status:403,phase:2</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1099D"></a><code class="literal">FILES_SIZES</code></h3></div></div><div></div></div><p>Collection. Contains a list of file sizes. Useful for implementing
      a size limitation on individual uploaded files. Note: only available if
      files were extracted from the request body. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>FILES_SIZES</strong></span> "@gt 100" log,deny,status:403,phase:2</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N109AB"></a><code class="literal">FILES_TMPNAMES</code></h3></div></div><div></div></div><p>Collection. Contains a collection of temporary files' names on the
      disk. Useful when used together with <code class="literal">@inspectFile.</code> Note: only available if files
      were extracted from the request body. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>FILES_TMPNAMES</strong></span> "@inspectFile /path/to/inspect_script.pl"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N109BD"></a><code class="literal">HTTP_</code></h3></div></div><div></div></div><p>This variable is a special prefix that is followed by a header
      name and can be used to access any request header. Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> HTTP_REFERER</strong></span> "www\.badsite\.com"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is for backward-compatibilty with ModSecurity 1.X
      rules. It has been superceded by the REQUEST_HEADERS variable
      (REQUEST_HEADERS:<span class="emphasis"><em>Headername</em></span>)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N109D4"></a><code class="literal">PATH_INFO</code></h3></div></div><div></div></div><p>Besides passing query information to a script/handler, you can
      also pass additional data, known as extra path information, as part of
      the URL. Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> PATH_INFO</strong></span> "^/(bin|etc|sbin|opt|usr)"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N109E2"></a><code class="literal">QUERY_STRING</code></h3></div></div><div></div></div><p>This variable holds form data passed to the script/handler by
      appending data after a question mark. Warning: Not URL-decoded.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>QUERY_STRING</strong></span> "attack"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N109F0"></a><code class="literal">REMOTE_ADDR</code></h3></div></div><div></div></div><p>This variable holds the IP address of the remote client.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REMOTE_ADDR</strong></span> "^192\.168\.1\.101$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N109FE"></a><code class="literal">REMOTE_HOST</code></h3></div></div><div></div></div><p>If HostnameLookUps are set to On, then this variable will hold the
      DNS resolved remote host name. If it is set to Off, then it will hold
      the remote IP address. Possible uses for this variable would be to deny
      known bad client hosts or network blocks, or conversely, to allow in
      authorized hosts. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REMOTE_HOST</strong></span> "\.evil\.network\org$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A0C"></a><code class="literal">REMOTE_PORT</code></h3></div></div><div></div></div><p>This variable holds information on the source port that the client
      used when initiating the connection to our web server. Example: in this
      example, we are evaluating to see if the <code class="literal">REMOTE_PORT</code>
      is less than 1024, which would indicate that the user is a privileged
      user (root).</p><pre class="programlisting">SecRule <span class="bold"><strong>REMOTE_PORT</strong></span> "@lt 1024" phase:1,log,pass,setenv:remote_port=privileged</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A1D"></a><code class="literal">REMOTE_USER</code></h3></div></div><div></div></div><p>This variable holds the username of the authenticated user. If
      there are no password (basic|digest) access controls in place, then this
      variable will be empty. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REMOTE_USER</strong></span> "admin"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This data will not be available in a proxy-mode deployment as the
      authentication is not local.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A31"></a><code class="literal">REQBODY_PROCESSOR</code></h3></div></div><div></div></div><p>Built-in processors are <code class="literal">URLENCODED</code>,<code class="literal">
      MULTIPART</code>, and <code class="literal">XML</code>.
      Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> REQBODY_PROCESSOR</strong></span> "^XML$ chain
SecRule XML "@validateDTD /opt/apache-frontend/conf/xml.dtd"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A4B"></a><code class="literal">REQBODY_PROCESSOR_ERROR</code></h3></div></div><div></div></div><p>Possible values are 0 (no error) or 1 (error). This variable will
      be set by request body processors (typically the
      <code class="classname">multipart/request-data</code> parser or the XML parser)
      when they fail to properly parse a request payload.</p><p>Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> REQBODY_PROCESSOR_ERROR</strong></span> "@eq 1" deny,phase:2</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Your policies <span class="emphasis"><em>must</em></span> have a rule to check
        REQBODY_PROCESSOR_ERROR at the beginning of phase 2. Failure to do so
        will leave the door open for impedance mismatch attacks. It is
        possible, for example, that a payload that cannot be parsed by
        ModSecurity can be successfully parsed by more tolerant parser
        operating in the application. If your policy dictates blocking then
        you should reject the request if error is detected. When operating in
        detection-only mode your rule should alert with high severity when
        request body processing fails.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A64"></a><code class="literal">REQBODY_PROCESSOR_ERROR_MSG</code></h3></div></div><div></div></div><p>Empty, or contains the error message from the processor.
      Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> REQBODY_PROCESSOR_ERROR_MSG</strong></span> "failed to parse" t:lowercase</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A72"></a><code class="literal">REQUEST_BASENAME</code></h3></div></div><div></div></div><p>This variable holds just the filename part of
      <code class="literal">REQUEST_FILENAME</code> (e.g. index.php). Warning: not
      urlDecoded. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_BASENAME</strong></span> "^login\.php$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A83"></a><code class="literal">REQUEST_BODY</code></h3></div></div><div></div></div><p>This variable holds the data in the request body (including
      POST_PAYLOAD data). REQUEST_BODY should be used if the original order of
      the arguements is important (ARGS should be used in all other cases).
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_BODY</strong></span> "^username=\w{25,}\&amp;password=\w{25,}\&amp;Submit\=login$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is only available if the content type is
      application/x-www-form-urlencoded.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10A97"></a><code class="literal">REQUEST_COOKIES</code></h3></div></div><div></div></div><p>This variable is a collection of all of the cookie data. Example:
      the following example is using the Ampersand special operator to count
      how many variables are in the collection. In this rule, it would trigger
      if the request does not include any Cookie headers.</p><pre class="programlisting">SecRule<span class="bold"><strong> &amp;REQUEST_COOKIES</strong></span> "@eq 0"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10AA5"></a><code class="literal">REQUEST_COOKIES_NAMES</code></h3></div></div><div></div></div><p>This variable is a collection of the cookie names in the request
      headers. Example: the following rule will trigger if the JSESSIONID
      cookie is not present.</p><pre class="programlisting">SecRule<span class="bold"><strong> &amp;REQUEST_COOKIES_NAMES:JSESSIONID</strong></span> "@eq 0"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10AB3"></a><code class="literal">REQUEST_FILENAME</code></h3></div></div><div></div></div><p>This variable holds the relative REQUEST_URI minus the
      QUERY_STRING part (e.g. /index.php). Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_FILENAME</strong></span> "^/cgi-bin/login\.php$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10AC1"></a><code class="literal">REQUEST_HEADERS</code></h3></div></div><div></div></div><p>This variable can be used as either a collection of all of the
      Request Headers or can be used to specify indivudual headers (by using
      REQUEST_HEADERS<span class="emphasis"><em>:Header-Name</em></span>). Example: the first
      example uses REQUEST_HEADERS as a collection and is applying the
      validateUrlEncoding operator against all headers.</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_HEADERS</strong></span> "@validateUrlEncoding"</pre><p>Example: the second example is targeting only the Host
      header.</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_HEADERS:Host</strong></span> "^[\d\.]+$" \
    "deny,log,status:400,msg:'Host header is a numeric IP address'"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10ADB"></a><code class="literal">REQUEST_HEADERS_NAMES</code></h3></div></div><div></div></div><p>This variable is a collection of the names of all of the Request
      Headers. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_HEADERS_NAMES</strong></span> "^x-forwarded-for" \
    "log,deny,status:403,t:lowercase,msg:'Proxy Server Used'"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10AE9"></a><code class="literal">REQUEST_LINE</code></h3></div></div><div></div></div><p>This variable holds the complete request line sent to the server
      (including the REQUEST_METHOD and HTTP version data). Example: this
      example rule will trigger if the request method is something other than
      GET, HEAD, POST or if the HTTP is something other than HTTP/0.9, 1.0 or
      1.1.</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_LINE</strong></span> "!(^((?:(?:pos|ge)t|head))|http/(0\.9|1\.0|1\.1)$)"</pre><p><span class="bold"><strong>Note</strong></span></p><p>Due to the default action transformation function lowercase, the
      regex strings should be in lowercase as well unless the t:none
      transformation function is specified for this particular rule.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10AFD"></a><code class="literal">REQUEST_METHOD</code></h3></div></div><div></div></div><p>This variable holds the Request Method used by the client.
      Example: the following example will trigger if the Request Method is
      either CONNECT or TRACE.</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_METHOD</strong></span> "^((?:connect|trace))$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>Due to the default action transformation function lowercase, the
      regex strings should be in lowercase as well unless the t:none
      transformation function is specified for this particular rule.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B11"></a><code class="literal">REQUEST_PROTOCOL</code></h3></div></div><div></div></div><p>This variable holds the Request Protocol Version information.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_PROTOCOL</strong></span> "!^http/(0\.9|1\.0|1\.1)$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>Due to the default action transformation function lowercase, the
      regex strings should be in lowercase as well unless the t:none
      transformation function is specified for this particular rule.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B25"></a><code class="literal">REQUEST_URI</code></h3></div></div><div></div></div><p>This variable holds the full URL including the QUERY_STRING data
      (e.g. /index.php?p=X), however it will never contain a domain name, even
      if it was provided on the request line. Warning: not urlDecoded. It also
      does not include either the REQUEST_METHOD or the HTTP version info.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>REQUEST_URI</strong></span> "attack"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B33"></a><code class="literal">REQUEST_URI_RAW</code></h3></div></div><div></div></div><p>Same as REQUEST_URI but will contain the domain name if it was
      provided on the request line (e.g.
      http://www.example.com/index.php?p=X). Warning: not urlDecoded.
      Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> REQUEST_URI_RAW</strong></span> "http:/"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B41"></a><code class="literal">RESPONSE_BODY</code></h3></div></div><div></div></div><p>This variable holds the data for the response payload.
      Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> RESPONSE_BODY</strong></span> "ODBC Error Code"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B4F"></a><code class="literal">RESPONSE_HEADERS</code></h3></div></div><div></div></div><p>This variable is similar to the REQUEST_HEADERS variable and can
      be used in the same manner. Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> RESPONSE_HEADERS</strong></span><span class="bold"><strong>:X-Cache</strong></span> "MISS"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable may not have access to some headers when running in
      embedded-mode. Headers such as Server, Date, Connection and Content-Type
      are added during a later Apache hook just prior to sending the data to
      the client. This data should be available, however, either during
      ModSecurity phase:5 (logging) or when running in proxy-mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B66"></a><code class="literal">RESPONSE_HEADERS_NAMES</code></h3></div></div><div></div></div><p>This variable is a collection of the response header names.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>RESPONSE_HEADERS_NAMES</strong></span> "Set-Cookie"</pre><p><span class="bold"><strong>Note</strong></span></p><p>Same limitations as RESPONSE_HEADERS with regards to access to
      some headers in embedded-mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B7A"></a><code class="literal">RESPONSE_PROTOCOL</code></h3></div></div><div></div></div><p>This variable holds the HTTP Response Protocol information.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>RESPONSE_PROTOCOL</strong></span> "^HTTP\/0\.9"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B88"></a><code class="literal">RESPONSE_STATUS</code></h3></div></div><div></div></div><p>This variable holds the HTTP Response Status Code generated by
      Apache. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>RESPONSE_STATUS</strong></span> "^[45]"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This directive may not work as expected in embedded-mode as Apache
      handles many of the stock response codes (404, 401, etc...) earlier in
      Phase 2. This variable should work as expected in a proxy-mode
      deployment.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10B9C"></a><code class="literal">RULE</code></h3></div></div><div></div></div><p>This variable provides access to the <code class="literal">id</code>,<code class="literal">rev</code>,<code class="literal">severity</code>, and <code class="literal">msg</code> fields of the rule that triggered the
      action. Only available for expansion in action strings (e.g.<code class="literal">setvar:tx.varname=%{rule.id}</code>). Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS:Host "@eq 0" "log,deny,setvar:tx.varname=<span class="bold"><strong>%{rule.id}</strong></span>"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10BBE"></a><code class="literal">SCRIPT_BASENAME</code></h3></div></div><div></div></div><p>This variable holds just the local filename part of
      SCRIPT_FILENAME. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>SCRIPT_BASENAME</strong></span> "^login\.php$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is not available in proxy mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10BD2"></a><code class="literal">SCRIPT_FILENAME</code></h3></div></div><div></div></div><p>This variable holds the full path on the server to the requested
      script. (e.g. SCRIPT_NAME plus the server path). Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>SCRIPT_FILENAME</strong></span> "^/usr/local/apache/cgi-bin/login\.php$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is not available in proxy mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10BE6"></a><code class="literal">SCRIPT_GID</code></h3></div></div><div></div></div><p>This variable holds the groupid (numerical value) of the group
      owner of the script. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>SCRIPT_GID</strong></span> "!^46$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is not available in proxy mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10BFA"></a><code class="literal">SCRIPT_GROUPNAME</code></h3></div></div><div></div></div><p>This variable holds the group name of the group owner of the
      script. Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> SCRIPT_GROUPNAME</strong></span> "!^apache$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is not available in proxy mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C0E"></a><code class="literal">SCRIPT_MODE</code></h3></div></div><div></div></div><p>This variable holds the script's permissions mode data (numerical
      - 1=execute, 2=write, 4=read and 7=read/write/execute). Example: will
      trigger if the script has the WRITE permissions set.</p><pre class="programlisting">SecRule <span class="bold"><strong>SCRIPT_MODE</strong></span> "^(2|3|6|7)$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is not available in proxy mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C22"></a><code class="literal">SCRIPT_UID</code></h3></div></div><div></div></div><p>This variable holds the userid (numerical value) of the owner of
      the script. Example: the example rule below will trigger if the UID is
      not 46 (the Apache user).</p><pre class="programlisting">SecRule<span class="bold"><strong> SCRIPT_UID</strong></span> "!^46$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is not available in proxy mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C36"></a><code class="literal">SCRIPT_USERNAME</code></h3></div></div><div></div></div><p>This variable holds the username of the owner of the script.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>SCRIPT_USERNAME</strong></span> "!^apache$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This variable is not available in proxy mode.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C4A"></a><code class="literal">SERVER_ADDR</code></h3></div></div><div></div></div><p>This variable contains the IP address of the server.
      Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> SERVER_ADDR</strong></span> "^192\.168\.1\.100$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C58"></a><code class="literal">SERVER_NAME</code></h3></div></div><div></div></div><p>This variable contains the server's hostname or IP address.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>SERVER_NAME</strong></span> "hostname\.com$"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This data is taken from the Host header submitted in the client
      request.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C6C"></a><code class="literal">SERVER_PORT</code></h3></div></div><div></div></div><p>This variable contains the local port that the web server is
      listening on. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>SERVER_PORT</strong></span> "^80$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C7A"></a><code class="literal">SESSION</code></h3></div></div><div></div></div><p>This variable is a collection, available only after <code class="literal">setsid</code> is executed. Example: the following
      example shows how to initialize a SESSION collection with setsid, how to
      use setvar to increase the session.score values, how to set the
      session.blocked variable and finally how to deny the connection based on
      the session:blocked value.</p><pre class="programlisting">SecRule REQUEST_COOKIES:PHPSESSID !^$ chain,nolog,pass
SecAction setsid:%{REQUEST_COOKIES.PHPSESSID}
SecRule REQUEST_URI "^/cgi-bin/finger$" "pass,log,setvar:<span class="bold"><strong>session.score</strong></span>=+10"
SecRule<span class="bold"><strong> SESSION:SCORE</strong></span> "@gt 50" "pass,log,setvar:<span class="bold"><strong>session.blocked</strong></span>=1"
SecRule<span class="bold"><strong> SESSION:BLOCKED</strong></span> "@eq 1" "log,deny,status:403"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10C98"></a><code class="literal">SESSIONID</code></h3></div></div><div></div></div><p>This variable is the value set with <code class="literal">setsid</code>. Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>SESSIONID</strong></span> !^$ chain,nolog,pass
SecRule REQUEST_COOKIES:PHPSESSID !^$
SecAction setsid:%{REQUEST_COOKIES.PHPSESSID}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CAA"></a><code class="literal">TIME</code></h3></div></div><div></div></div><p>This variable holds a formatted string representing the time
      (hour:minute:second). Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> TIME</strong></span> "^(([1](8|9))|([2](0|1|2|3))):\d{2}:\d{2}$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CB8"></a><code class="literal">TIME_DAY</code></h3></div></div><div></div></div><p>This variable holds the current date (1-31). Example: this rule
      would trigger anytime between the 10th and 20th days of the
      month.</p><pre class="programlisting">SecRule <span class="bold"><strong>TIME_DAY</strong></span> "^(([1](0|1|2|3|4|5|6|7|8|9))|20)$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CC6"></a><code class="literal">TIME_EPOCH</code></h3></div></div><div></div></div><p>This variable holds the time in seconds since 1970.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>TIME_EPOCH</strong></span> "@gt 1000"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CD4"></a><code class="literal">TIME_HOUR</code></h3></div></div><div></div></div><p>This variable holds the current hour (0-23). Example: this rule
      would trigger during "off hours".</p><pre class="programlisting">SecRule<span class="bold"><strong> TIME_HOUR</strong></span> "^(0|1|2|3|4|5|6|[1](8|9)|[2](0|1|2|3))$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CE2"></a><code class="literal">TIME_MIN</code></h3></div></div><div></div></div><p>This variable holds the current minute (0-59). Example: this rule
      would trigger during the last half hour of every hour.</p><pre class="programlisting">SecRule <span class="bold"><strong>TIME_MIN</strong></span> "^(3|4|5)"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CF0"></a><code class="literal">TIME_MON</code></h3></div></div><div></div></div><p>This variable holds the current month (0-11). Example: this rule
      would match if the month was either November (10) or December
      (11).</p><pre class="programlisting">SecRule<span class="bold"><strong> TIME_MON</strong></span> "^1"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10CFE"></a><code class="literal">TIME_SEC</code></h3></div></div><div></div></div><p>This variable holds the current second count (0-59).
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>TIME_SEC</strong></span> "@gt 30"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D0C"></a><code class="literal">TIME_WDAY</code></h3></div></div><div></div></div><p>This variable holds the current weekday (0-6). Example: this rule
      would trigger only on week-ends (Saturday and Sunday).</p><pre class="programlisting">SecRule <span class="bold"><strong>TIME_WDAY</strong></span> "^(0|6)$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D1A"></a><code class="literal">TIME_YEAR</code></h3></div></div><div></div></div><p>This variable holds the current four-digit year data.
      Example:</p><pre class="programlisting">SecRule <span class="bold"><strong>TIME_YEAR</strong></span> "^2006$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D28"></a><code class="literal">TX</code></h3></div></div><div></div></div><p>Transaction Collection. This is used to store pieces of data,
      create a transaction anomaly score, and so on. Transaction variables are
      set for 1 request/response cycle. The scoring and evaluation will not
      last past the current request/response process. Example: In this
      example, we are using setvar to increase the tx.score value by 5 points.
      We then have a follow-up run that will evaluate the transactional score
      this this request and then it will decided whether or not to allow/deny
      the request through.</p><pre class="programlisting">SecRule WEBSERVER_ERROR_LOG "does not exist" "phase:5,pass,<span class="bold"><strong>setvar:tx.score=+5</strong></span>"
SecRule<span class="bold"><strong> TX:SCORE</strong></span> "@gt 20" deny,log</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D3A"></a><code class="literal">USERID</code></h3></div></div><div></div></div><p>This variable is the value set with <code class="literal">setuid</code>. Example:</p><pre class="programlisting">SecAction setuid:%{REMOTE_USER},nolog
SecRule<span class="bold"><strong> USERID</strong></span> "Admin"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D4C"></a><code class="literal">WEBAPPID</code></h3></div></div><div></div></div><p>This variable is the value set with <code class="literal">SecWebAppId</code>. Example:</p><pre class="programlisting">SecWebAppId "WebApp1"
SecRule<span class="bold"><strong> WEBAPPID</strong></span> "WebApp1" "chain,log,deny,status:403"
SecRule REQUEST_HEADERS:Transfer-Encoding "!^$"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D5E"></a><code class="literal">WEBSERVER_ERROR_LOG</code></h3></div></div><div></div></div><p>Contains zero or more error messages produced by the web server.
      Access to this variable is in phase:5 (logging). Example:</p><pre class="programlisting">SecRule<span class="bold"><strong> WEBSERVER_ERROR_LOG</strong></span> "File does not exist" "phase:5,setvar:tx.score=+5"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10D6C"></a><code class="literal">XML</code></h3></div></div><div></div></div><p>Can be used standalone (as a target for validateDTD and
      validateSchema) or with an XPath expression parameter (which makes it a
      valid target for any function that accepts plain text). Example using
      XPath:</p><pre class="programlisting">SecDefaultAction log,deny,status:403,phase:2
SecRule REQUEST_HEADERS:Content-Type ^text/xml$ \
    phase:1,t:lowercase,nolog,pass,ctl:requestBodyProcessor=<span class="bold"><strong>XML</strong></span>
SecRule REQBODY_PROCESSOR "<span class="bold"><strong>!^XML$</strong></span>" skip:2
SecRule <span class="bold"><strong>XML:/employees/employee/name/text()</strong></span> Fred
SecRule <span class="bold"><strong>XML:/xq:employees/employee/name/text()</strong></span> Fred \
    xmlns:xq=http://www.example.com/employees</pre><p>The first XPath expression does not use namespaces. It would match
      against payload such as this one:</p><pre class="programlisting">&lt;employees&gt;
    &lt;employee&gt;
        &lt;name&gt;Fred Jones&lt;/name&gt;
        &lt;address location="home"&gt;
            &lt;street&gt;900 Aurora Ave.&lt;/street&gt;
            &lt;city&gt;Seattle&lt;/city&gt;
            &lt;state&gt;WA&lt;/state&gt;
            &lt;zip&gt;98115&lt;/zip&gt;
        &lt;/address&gt;
        &lt;address location="work"&gt;
            &lt;street&gt;2011 152nd Avenue NE&lt;/street&gt;
            &lt;city&gt;Redmond&lt;/city&gt;
            &lt;state&gt;WA&lt;/state&gt;
            &lt;zip&gt;98052&lt;/zip&gt;
        &lt;/address&gt;
        &lt;phone location="work"&gt;(425)555-5665&lt;/phone&gt;
        &lt;phone location="home"&gt;(206)555-5555&lt;/phone&gt;
        &lt;phone location="mobile"&gt;(206)555-4321&lt;/phone&gt;
    &lt;/employee&gt;
&lt;/employees&gt;</pre><p>The second XPath expression does use namespaces. It would match
      the following payload:</p><pre class="programlisting">&lt;xq:employees xmlns:xq="http://www.example.com/employees"&gt;
    &lt;employee&gt;
        &lt;name&gt;Fred Jones&lt;/name&gt;
        &lt;address location="home"&gt;
            &lt;street&gt;900 Aurora Ave.&lt;/street&gt;
            &lt;city&gt;Seattle&lt;/city&gt;
            &lt;state&gt;WA&lt;/state&gt;
            &lt;zip&gt;98115&lt;/zip&gt;
        &lt;/address&gt;
        &lt;address location="work"&gt;
            &lt;street&gt;2011 152nd Avenue NE&lt;/street&gt;
            &lt;city&gt;Redmond&lt;/city&gt;
            &lt;state&gt;WA&lt;/state&gt;
            &lt;zip&gt;98052&lt;/zip&gt;
        &lt;/address&gt;
        &lt;phone location="work"&gt;(425)555-5665&lt;/phone&gt;
        &lt;phone location="home"&gt;(206)555-5555&lt;/phone&gt;
        &lt;phone location="mobile"&gt;(206)555-4321&lt;/phone&gt;
    &lt;/employee&gt;
&lt;/xq:employees&gt;</pre><p>Note the different namespace used in the second example.</p><p>To learn more about XPath we suggest the following
      resources:</p><div class="orderedlist"><ol type="1"><li><p><a href="http://www.w3.org/TR/xpath" target="_top">XPath
          Standard</a></p></li><li><p><a href="http://www.zvon.org/xxl/XPathTutorial/General/examples.html" target="_top">XPath
          Tutorial</a></p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="06-transformation-functions"></a>Transformation functions</h2></div></div><div></div></div><p>When ModSecurity receives request or response information, it makes
    a copy of this data and places it into memory. It is on this data in
    memory that transformation functions are applied. The raw request/response
    data is never altered. Transformation functions are used to transform a
    variable before testing it in a rule.</p><p><span class="bold"><strong>Note</strong></span></p><p>The default transformation function setting is - lowercase,
    replaceNulls and compressWhitespace (in this order).</p><p>The following rule will ensure that an attacker does not use mixed
    case in order to evade the ModSecurity rule:</p><p><pre class="programlisting">SecRule ARG:p "xp_cmdshell" <span class="bold"><strong>"t:lowercase"</strong></span></pre> multiple
    tranformation actions can be used in the same rule, for example the
    following rule also ensures that an attacker does not use URL encoding
    (%xx encoding) for evasion. Note the order of the transformation
    functions, which ensures that a URL encoded letter is first decoded and
    than translated to lower case.</p><p><pre class="programlisting">SecRule ARG:p "xp_cmdshell" <span class="bold"><strong>"t:urlDecode,t:lowercase"</strong></span></pre></p><p>One can use the SetDefaultAction command to ensure the translation
    occurs for every rule until the next. Note that translation actions are
    additive, so if a rule explicitly list actions, the translation actions
    set by SetDefaultAction are still performed.</p><p><pre class="programlisting">SecDefaultAction <span class="bold"><strong>t:urlDecode,t:lowercase</strong></span></pre></p><p>The following transformation functions are supported:</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10DC5"></a><code class="literal">base64Decode</code></h3></div></div><div></div></div><p>This function decoes a base64-encoded string.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10DCB"></a><code class="literal">base64Encode</code></h3></div></div><div></div></div><p>This function encodes input string using base64 encoding.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10DD1"></a><code class="literal">compressWhitespace</code></h3></div></div><div></div></div><p>This function is enabled by default. It converts whitespace
      characters (32, \f, \t, \n, \r, \v, 160) to spaces (ASCII 32) and then
      compresses multiple space characters into only one.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10DD7"></a><code class="literal">escapeSeqDecode</code></h3></div></div><div></div></div><p>This function decode ANSI C escape sequences:<code class="literal"> \a</code>,<code class="literal"> \b</code>,
      <code class="literal">\f</code>, <code class="literal">\n</code>, <code class="literal">\r</code>,
      <code class="literal">\t</code>, <code class="literal">\v</code>, <code class="literal">\\</code>,
      <code class="literal">\?</code>, <code class="literal">\'</code>, <code class="literal">\"</code>,
      <code class="literal">\xHH</code> (hexadecimal), <code class="literal">\0OOO</code> (octal). Invalid encodings are left in
      the output.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E11"></a><code class="literal">hexDecode</code></h3></div></div><div></div></div><p>This function decodes a hex-encoded string.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E17"></a><code class="literal">hexEncode</code></h3></div></div><div></div></div><p>This function encodes input as hex-encoded string.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E1D"></a><code class="literal">htmlEntityDecode</code></h3></div></div><div></div></div><p>This function decodes HTML entities present in input. The
      following variants are supported:</p><div class="itemizedlist"><ul type="disc"><li><p><code class="literal">&amp;#xHH</code> and <code class="literal">&amp;#xHH;</code> (where H is any hexadecimal
          number)</p></li><li><p><code class="literal">&amp;#DDD</code> and <code class="literal">&amp;#DDD;</code> (where D is any decimal
          number)</p></li><li><p><code class="literal">&amp;quot</code> and <code class="literal">&amp;quot;</code></p></li><li><p><code class="literal">&amp;nbsp</code> and <code class="literal">&amp;nbsp;</code></p></li><li><p><code class="literal">&amp;lt</code> and <code class="literal">&amp;lt;</code></p></li><li><p><code class="literal">&amp;gt</code> and <code class="literal">&amp;gt;</code></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E5C"></a><code class="literal">lowercase</code></h3></div></div><div></div></div><p>This function is enabled by default. It converts all charactes to
      lowercase using the current C locale.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E62"></a><code class="literal">md5</code></h3></div></div><div></div></div><p>This function calculates an MD5 hash from input.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E68"></a><code class="literal"><code class="literal">none</code></code></h3></div></div><div></div></div><p>This not an actual transformation function but an instruction to
      ModSecurity to remove all transformation functions associated with the
      current rule and start from scratch.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E6F"></a><code class="literal">normalisePath</code></h3></div></div><div></div></div><p>This function will remove multiple slashes, self-references and
      directory back-references (except when they are at the beginning of the
      path).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E75"></a><code class="literal">normalisePathWin</code></h3></div></div><div></div></div><p>Same as normalisePath, but will first convert backslash characters
      to forward slashes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E7B"></a><code class="literal">removeNulls</code></h3></div></div><div></div></div><p>This function removes NULL bytes from input.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E81"></a><code class="literal">removeWhitespace</code></h3></div></div><div></div></div><p>This function removes all whitespace characters.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E87"></a><code class="literal">replaceComments</code></h3></div></div><div></div></div><p>This function replaces each occurence of a C-style comments
      (<code class="literal">/* ... */</code>) with a single space
      (multiple consecutive occurences of a space will not be compressed).
      Unterminated comments will too be replaced with a space (ASCII 32).
      However, a standalone termination of a comment (<code class="literal">*/</code>) will not be acted upon.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E95"></a><code class="literal">replaceNulls</code></h3></div></div><div></div></div><p>This function is enabled by default. It replaces NULL bytes in
      input with spaces (ASCII 32).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10E9B"></a><code class="literal">urlDecode</code></h3></div></div><div></div></div><p>This function decodes an URL-encoded input string. Invalid
      encodings (i.e. the ones that use non-hexadecimal characters, or the
      ones that are at the end of string and have one or two characters
      missing) will not be converted. If you want to detect invalid encodings
      use the <code class="literal">@validateUrlEncoding</code>
      operator. The transformational function should not be used against
      variables that have already been URL-decoded unless it is your intention
      to perform URL decoding twice!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10EA5"></a><code class="literal">urlDecodeUni</code></h3></div></div><div></div></div><p>In addition to decoding %xx like <code class="literal">urlDecode, urlDecodeUni</code> also decodes <code class="literal">%uXXXX</code> encoding. If the code is in the range
      of FF01-FF5E (the full width ASCII codes), then the higher byte is used
      to detect and adjust the lower byte. Otherwise, only the lower byte will
      be used and the higher byte zeroed.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10EB3"></a><code class="literal">urlEncode</code></h3></div></div><div></div></div><p>This function encodes input using URL encoding.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10EB9"></a><code class="literal">sha1</code></h3></div></div><div></div></div><p>This function calculates a SHA1 hash from input.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="07-actions"></a>Actions</h2></div></div><div></div></div><p>Each action belongs to one of five groups:</p><div class="orderedlist"><ol type="1"><li><p><span class="emphasis"><em>Disruptive actions</em></span> - are those actions
        where ModSecurity will intercept the data. They can only appear in the
        first rule in a chain.</p></li><li><p><span class="emphasis"><em>Non-disruptive actions</em></span> - can appear
        anywhere.</p></li><li><p><span class="emphasis"><em>Flow actions</em></span> - can appear only in the first
        rule in a chain.</p></li><li><p><span class="emphasis"><em>Meta-data actions</em></span>(<code class="literal">id</code>,<code class="literal">
        rev</code>,<code class="literal"> severity</code>,<code class="literal"> msg</code>) - can only appear in the first rule in
        a chain.</p></li><li><p><span class="emphasis"><em>Data actions</em></span> - can appear anywhere; these
        actions are completely passive and only serve to carry data used by
        other actions.</p></li></ol></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10EF1"></a><code class="literal">allow</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Stops processing on
      a successful match and allows transaction to proceed.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REMOTE_ADDR "^192\.168\.1\.100$" nolog,phase:1,<span class="bold"><strong>allow</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>The allow action only applies to the current processing phase. If
      your intent is to explicitly allow a request, then you should use the
      "ctl" action to turn the ruleEngine off -<code class="literal">
      ctl:ruleEngine=Off</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10F11"></a><code class="literal">auditlog</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Marks the
      transaction for logging in the audit log.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REMOTE_ADDR "^192\.168\.1\.100$" <span class="bold"><strong>auditlog</strong></span>,phase:1,allow</pre><p><span class="bold"><strong>Note</strong></span></p><p>The auditlog action is now explicit if log is already
      specified.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10F2E"></a><code class="literal">capture</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> When used together
      with the regular expression operator, capture action will create copies
      of regular expression captures and place them into the transaction
      variable collection. Up to ten captures will be copied on a successful
      pattern match, each with a name consisting of a digit from 0 to
      9.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_BODY "^username=(\w{25,})" phase:2,<span class="bold"><strong>capture</strong></span>,t:none,chain
SecRule TX:1 "(?:(?:a(dmin|nonymous)))"</pre><p><span class="bold"><strong>Note</strong></span></p><p>The 0 data captures the entire REGEX match and 1 captures the data
      in the first parantheses, etc...</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10F4B"></a><code class="literal">chain</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Chains the rule
      where the action is placed with the rule that immediately follows it.
      The result is called a<span class="emphasis"><em> rule chain</em></span>. Chained rules
      allow for more complex rule matches where you want to use a number of
      different VARIABLES to create a better rule and to help prevent false
      positives.</p><p><span class="bold"><strong>Action Group:</strong></span> Flow</p><p>Example:</p><pre class="programlisting"># Refuse to accept POST requests that do
# not specify request body length 
SecRule REQUEST_METHOD ^POST$<span class="bold"><strong> chain</strong></span>
SecRule REQUEST_HEADER:Content-Length ^$</pre><p><span class="bold"><strong>Note</strong></span></p><p>In programming language concepts, think of chained rules somewhat
      similar to AND conditional statements. The actions specified in the
      first portion of the chained rule will only be triggered if all of the
      variable checks return positive hits. If one aspect of the chained rule
      is negative, then the entire rule chain is negative. Also note that
      disruptive actions, execution phases, metadata actions (id, rev, msg)
      and skip actions can only be specified on by the chain starter
      rule.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10F6B"></a><code class="literal">ctl</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> The ctl action
      allows configuration options to be updated for the transaction.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting"># Parse requests with Content-Type "text/xml" as XML 
SecRule REQUEST_CONTENT_TYPE ^text/xml nolog,pass,<span class="bold"><strong>ctl:requestBodyProcessor=XML</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>The following configuration options are supported:</p><div class="orderedlist"><ol type="1"><li><p><code class="literal">auditEngine</code></p></li><li><p><code class="literal">auditLogParts</code></p></li><li><p><code class="literal">debugLogLevel</code></p></li><li><p><code class="literal">requestBodyAccess</code></p></li><li><p><code class="literal">requestBodyLimit</code></p></li><li><p><code class="literal">requestBodyProcessor</code></p></li><li><p><code class="literal">responseBodyAccess</code></p></li><li><p><code class="literal">responseBodyLimit</code></p></li><li><p><code class="literal">ruleEngine</code></p></li></ol></div><p>With the exception of<code class="literal">
      requestBodyProcessor</code>, each configuration option corresponds to
      one configuration directive and the usage is identical.</p><p>The requestBodyProcessor option allows you to configure the
      request body processor. By default ModSecurity will use the <code class="literal">URLENCODED</code> and<code class="literal">
      MULTIPART</code> processors to process an <code class="literal">application/x-www-form-urlencoded</code> and a
      <code class="literal">multipart/form-data</code> body,
      respectively. A third processor, XML, is also supported, but it is never
      used implicitly. Instead you must tell ModSecurity to use it by placing
      a few rules in the<code class="literal"> REQUEST_HEADERS</code>
      processing phase. After the request body was processed as XML you will
      be able to use the XML-related features to inspect it.</p><p>Request body processors will not interrupt a transaction if an
      error occurs during parsing. Instead they will set variables<code class="literal"> REQBODY_PROCESSOR_ERROR</code> and<code class="literal"> REQBODY_PROCESSOR_ERROR_MSG</code>. These variables
      should be inspected in the <code class="literal">REQUEST_BODY</code> phase and an appropriate action
      taken.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10FE1"></a><code class="literal">deny</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Stops rule
      processing and intercepts transaction.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "nikto" log,<span class="bold"><strong>deny</strong></span>,msg:'Nikto Scanners Identified"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N10FF8"></a><code class="literal">deprecatevar</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Decrement counter
      based on its age.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example: The following example will decrement the counter by 60
      every 300 seconds.</p><pre class="programlisting">SecAction deprecatevar:session.score=60/300</pre><p><span class="bold"><strong>Note</strong></span></p><p>Counter values are always positive, meaning the value will never
      go below zero.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11011"></a><code class="literal">drop</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Immediately initiate
      a "connection close" action to tear down the TCP connection by sending a
      FIN packet.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example: The following example initiates an IP collection for
      tracking Basic Authentication attempts. If the client goes over the
      threshold of more than 25 attempts in 2 minutes, it will DROP subsequent
      connections.</p><pre class="programlisting">SecAction initcol:ip=%{REMOTE_ADDR},nolog
SecRule ARGS:login "!^$" \
    nolog,phase:1,setvar:ip.auth_attempt=+1,deprecatevar:ip.auth_attempt=20/120
SecRule IP:AUTH_ATTEMPT "@gt 25" \
    log,<span class="bold"><strong>drop</strong></span>,phase:1,msg:'Possible Brute Force Attack"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This action is extremely useful when responding to both Brute
      Force and Denial of Service attacks in that, in both cases, you want to
      minimize both the network bandwidth and the data returned to the client.
      This action causes error message to appear in the log "(9)Bad file
      descriptor: core_output_filter: writing data to the network"</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1102E"></a><code class="literal">exec</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Executes an external
      script/binary supplied as parameter.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_URI "^/cgi-bin/script\.pl" \
    "log,<span class="bold"><strong>exec:/usr/local/apache/bin/test.sh</strong></span>,phase:1"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This directive does not effect a primary action if it exists. This
      action will always call script with no parameters, but providing all
      information in the environment. All the usual CGI environment variables
      will be there. You can have one binary executed per filter match.
      Execution will add the header mod_security-executed to the list of
      request headers. You should be aware that forking a threaded process
      results in all threads being replicated in the new process. Forking can
      therefore incur larger overhead in multithreaded operation. The script
      you execute must write something (anything) to stdout. If it doesn't
      ModSecurity will assume execution didn't work.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1104B"></a><code class="literal">expirevar</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Configurescollection
      variable to expire after the given time in seconds.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_COOKIES:JSESSIONID "!^$" nolog,phase:1,pass,chain
SecAction setsid:%{REQUEST_COOKIES:JSESSIONID}
SecRule REQUEST_URI "^/cgi-bin/script\.pl" \
    "log,allow,setvar:session.suspicious=1,<span class="bold"><strong>expirevar:session.suspicious=3600</strong></span>,phase:1"</pre><p><span class="bold"><strong>Note</strong></span></p><p>You should use expirevar actions at the same time that you use
      setvar actions in order to keep the indended expiration time. If they
      are used on their own (perhaps in a SecAction directive) the expire time
      could get re-set. When variables are removed from collections, and there
      are no other changes, collections are not written to disk at the end of
      request. This is because the variables can always be expired again when
      the collection is read again on a subsequent request.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11068"></a><code class="literal">id</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Assigns a unique ID
      to the rule or chain.</p><p><span class="bold"><strong>Action Group:</strong></span> Metadata</p><p>Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS:Host "@eq 0" \
    "log,<span class="bold"><strong>id:60008</strong></span>,severity:2,msg:'Request Missing a Host Header'"</pre><p><span class="bold"><strong>Note</strong></span></p><p>These are the reserved ranges:</p><div class="itemizedlist"><ul type="disc"><li><p>1-99,999; reserved for local (internal) use. Use as you
          see fit but do not use this range for rules that are distributed to
          others.</p></li><li><p>100,000-199,999; reserved for internal use of the engine, to
          assign to rules that do not have explicit IDs.</p></li><li><p>200,000-299,999; reserved for rules published at
          modsecurity.org.</p></li><li><p>300,000-399,999; reserved for rules published at
          gotroot.com.</p></li><li><p>400,000-419,999; unused (available for reservation).</p></li><li><p>420,000-429,999; reserved for <a href="http://projects.otaku42.de/wiki/ScallyWhack" target="_top">ScallyWhack</a>.</p></li><li><p>430,000-899,999; unused (available for reservation).</p></li><li><p>900,000-999,999; reserved for the <a href="http://www.modsecurity.org/projects/rules/" target="_top">Core Rules</a>
          project.</p></li><li><p>1,000,000 and above; unused (available for
          reservation).</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N110AA"></a><code class="literal">initcol</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Initialises a named
      persistent collection, either by loading data from storage or by
      creating a new collection in memory.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example: The following example initiates IP address
      tracking.</p><pre class="programlisting">SecAction<span class="bold"><strong> initcol:ip=%{REMOTE_ADDR}</strong></span>,nolog</pre><p><span class="bold"><strong>Note</strong></span></p><p>Every collection contains several built-in variables that are
      read-only:</p><div class="orderedlist"><ol type="1"><li><p><code class="literal">CREATE_TIME</code> - date/time of
          the creation of the collection.</p></li><li><p><code class="literal">KEY</code> - the value of the
          initcol variable (the client's IP address in the example).</p></li><li><p><code class="literal">LAST_UPDATE_TIME</code> -
          date/time of the last update to the collection.</p></li><li><p><code class="literal">TIMEOUT</code> - date/time in
          seconds when the collection will be updated on disk from memory (if
          no other updates occur).</p></li><li><p><code class="literal">UPDATE_COUNTER</code> - how many
          times the collection has been updated since creation.</p></li><li><p><code class="literal">UPDATE_RATE</code> - is the
          average rate updates per minute since creation.</p></li></ol></div><p>Collections are loaded into memory when the initcol action is
      encountered. The collection in storage will be updated (and the
      appropriate counters increased) <span class="emphasis"><em>only</em></span> if it was
      changed during transaction processing.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>To create a collection to hold session variables (<code class="literal">SESSION</code>) use action <code class="literal">setsid</code>. To create a collection to hold user
        variables (<code class="literal">USER</code>) use action
        <code class="literal">setuid</code>.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>At this time it is only possible to have three
        collections:<code class="literal"> IP</code>,<code class="literal"> SESSION</code>, and <code class="literal">USER</code>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11115"></a><code class="literal">log</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Indicates that a
      successful match of the rule needs to be logged.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecAction initcol:ip=%{REMOTE_ADDR},<span class="bold"><strong>log</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>This action will log matches to the Apache error log file and the
      ModSecurity audit log.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11131"></a><code class="literal">msg</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Assigns a custom
      message to the rule or chain.</p><p><span class="bold"><strong>Action Group:</strong></span> Metadata</p><p>Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS:Host "@eq 0" \
    "log,id:60008<span class="bold"><strong>,</strong></span>severity:2,<span class="bold"><strong>msg:'Request Missing a Host Header'"</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>The msg information appears in the error and/or audit log files
      and is not sent back to the client in response headers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11151"></a><code class="literal">multiMatch</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> If enabled
      ModSecurity will perform multiple operator invocations for every target,
      before and after every anti-evasion transformation is performed.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecDefaultAction log,deny,phase:1,t:removeNulls,t:lowercase
SecRule ARGS "attack" <span class="bold"><strong>multiMatch</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>Normally, variables are evaluated once, only after all
      transformation functions have completed. With multiMatch, variables are
      checked against the operator before and after every transformation
      function that changes the input.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1116D"></a><code class="literal">noauditlog</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Indicates that a
      successful match of the rule should not be used as criteria whether the
      transaction should be logged to the audit log.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "Test" allow,<span class="bold"><strong>noauditlog</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>If the SecAuditEngine is set to On, all of the transactions will
      be logged. If it is set to RelevantOnly, then you can control it with
      the noauditlog action. Even if the noauditlog action is applied to a
      specific rule and a rule either before or after triggered an audit
      event, then the tranaction will be logged to the audit log. The correct
      way to disable audit logging for the entire transaction is to use
      "<code class="literal">ctl:auditEngine=Off</code>"</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1118D"></a><code class="literal">nolog</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Prevents rule
      matches from appearing in both the error and audit logs.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "Test" allow,<span class="bold"><strong>nolog</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>The nolog action also implies noauditlog.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N111A9"></a><code class="literal">pass</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Continues processing
      with the next rule in spite of a successful match.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "Test" log,<span class="bold"><strong>pass</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>Transaction will not be interrupted but it will be logged (unless
      logging has been suppressed).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N111C5"></a><code class="literal">pause</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Pauses transaction
      processing for the specified number of milliseconds.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "Test" log,deny,status:403,<span class="bold"><strong>pause:5000</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>This feature can be of limited benefit for slowing down Brute
      Force Scanners, however use with care. If you are under a Denial of
      Service type of attack, the pause feature may make matters worse as this
      feature will cause child processes to sit idle until the pause is
      completed.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N111E1"></a><code class="literal">phase</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Places the rule (or
      the rule chain) into one of five available processing phases.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecDefaultAction log,deny,<span class="bold"><strong>phase:1</strong></span>,t:removeNulls,t:lowercase
SecRule REQUEST_HEADERS:User-Agent "Test" log,deny,status:403</pre><p><span class="bold"><strong>Note</strong></span></p><p>Keep in mind that is you specify the incorrect phase, the target
      variable that you specify may be empty. This could lead to a false
      negative situation where your variable and operator (RegEx) may be
      correct, but it misses malicious data because you specified the wrong
      phase.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N111FE"></a><code class="literal">proxy</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Intercepts
      transaction by forwarding request to another web server using the proxy
      backend.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "Test" log,<span class="bold"><strong>proxy:http://www.honeypothost.com/</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>For this action to work, mod_proxy must also be installed. This
      action is useful if you would like to proxy matching requests onto a
      honeypot webserver.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1121A"></a><code class="literal">redirect</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Intercepts
      transaction by issuing a redirect to the given location.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "Test" \
    log,<span class="bold"><strong>redirect:http://www.hostname.com/failed.html</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>If the <code class="literal">status</code> action is present
      and its value is acceptable (301, 302, 303, or 307) it will be used for
      the redirection. Otherwise status code 302 will be used.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1123A"></a><code class="literal">rev</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Specifies rule
      revision.</p><p><span class="bold"><strong>Action Group:</strong></span> Metadata</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_METHOD "^PUT$" "id:340002,<span class="bold"><strong>rev:1</strong></span>,severity:2,msg:'Restricted HTTP function'"</pre><p><span class="bold"><strong>Note</strong></span></p><p>This action is used in combination with the <code class="literal">id</code> action to allow the same rule ID to be used
      after changes take place but to still provide some indication the rule
      changed.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1125B"></a><code class="literal">sanitiseArg</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Sanitises (replaces
      each byte with an asterisk) a named request argument prior to audit
      logging.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecAction nolog,phase:2,<span class="bold"><strong>sanitiseArg:password</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>The sanitize actions do not sanitize any data within the actual
      raw requests but only on the copy of data within memory that is set to
      log to the audit log. It will not sanitize the data in the
      modsec_debug.log file (if the log level is set high enough to capture
      this data).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11277"></a><code class="literal">sanitiseMatched</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Sanitises the
      variable (request argument, request header, or response header) that
      caused a rule match.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example: This action can be used to sanitise arbitrary transaction
      elements when they match a condition. For example, the example below
      will sanitise any argument that contains the word<span class="emphasis"><em>
      password</em></span> in the name.</p><pre class="programlisting">SecRule ARGS_NAMES password nolog,pass,<span class="bold"><strong>sanitiseMatched</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>Same note as sanitiseArg.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11296"></a><code class="literal">sanitiseRequestHeader</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Sanitises a named
      request header.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example: This will sanitise the data in the Authorization
      header.</p><pre class="programlisting">SecAction log,phase:1,<span class="bold"><strong>sanitiseRequestHeader:Authorization</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>Same note as sanitiseArg.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N112B2"></a><code class="literal">sanitiseResponseHeader</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Sanitises a named
      response header.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example: This will sanitise the Set-Cookie data sent to the
      client.</p><pre class="programlisting">SecAction log,phase:3,<span class="bold"><strong>sanitiseResponseHeader:Set-Cookie</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>Same note as sanitiseArg.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N112CE"></a><code class="literal">severity</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Assigns severity to
      the rule it is placed with.</p><p><span class="bold"><strong>Action Group:</strong></span> Metadata</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_METHOD "^PUT$" "id:340002,rev:1,<span class="bold"><strong>severity:2</strong></span>,msg:'Restricted HTTP function'"</pre><p><span class="bold"><strong>Note</strong></span></p><p>The severity numbers follow the Syslog convention:</p><div class="itemizedlist"><ul type="disc"><li><p>0 = EMERGENCY</p></li><li><p>1 = ALERT</p></li><li><p>2 = CRITICAL</p></li><li><p>3 = ERROR</p></li><li><p>4 = WARNING</p></li><li><p>5 = NOTICE</p></li><li><p>6 = INFO</p></li><li><p>7 = DEBUG</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11304"></a><code class="literal">setuid</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Special-purpose
      action that initialises the <code class="literal">USER</code>
      collection.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecAction <span class="bold"><strong>setuid:%{REMOTE_USER}</strong></span>,nolog</pre><p><span class="bold"><strong>Note</strong></span></p><p>After initialisation takes place the variable <code class="literal">USERID</code> will be available for use in the
      subsequent rules.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11329"></a><code class="literal">setsid</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span>
      Special-purposeaction that initialises the <code class="literal">SESSION</code> collection.</p><p><span class="bold"><strong>Action Group:
      </strong></span>Non-Disruptive</p><p>Example:</p><pre class="programlisting"># Initialise session variables using the session cookie value 
SecRule REQUEST_COOKIES:PHPSESSID !^$ chain,nolog,pass
SecAction <span class="bold"><strong>setsid:%{REQUEST_COOKIES.PHPSESSID}</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>On first invocation of this action the collection will be empty
      (not taking the pre-defined variables into account - see <code class="literal">initcol</code> for more information). On subsequent
      invocations the contents of the collection (session, in this case) will
      be retrieved from storage. After initialisation takes place the
      variable<code class="literal"> SESSIONID</code> will be available
      for use in the subsequent rules.This action understands each application
      maintains its own set of sessions. It will utilise the current web
      application ID to create a session namespace.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11351"></a><code class="literal">setenv</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Creates, removes, or
      updates an environment variable.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Examples:</p><p>To create a new variable (if you omit the value <code class="literal">1</code> will be used):</p><pre class="programlisting">setenv:name=value</pre><p>To remove a variable:</p><pre class="programlisting">setenv:!name</pre><p><span class="bold"><strong>Note</strong></span></p><p>This action can be used to establish communication with other
      Apache modules.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11375"></a><code class="literal">setvar</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Creates, removes, or
      updates a variable in the specified collection.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Examples:</p><p>To create a new variable:</p><pre class="programlisting">setvar:tx.score=10</pre><p>To remove a variable prefix the name with exclamation mark:</p><pre class="programlisting">setvar:!tx.score</pre><p>To increase or decrease variable value use <code class="literal">+</code> and <code class="literal">-</code>
      characters in front of a numerical value:</p><pre class="programlisting">setvar:tx.score=+5</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1139C"></a><code class="literal">skip</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Skips one or more
      rules (or chains) on successful match.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><p><pre class="programlisting">SecRule REQUEST_URI "^/$" "chain,<span class="bold"><strong>skip:2</strong></span>"
SecRule REMOTE_ADDR "^127\.0\.0\.1$" "chain"
SecRule REQUEST_HEADERS:User-Agent "^Apache \(internal dummy connection\)$" "t:none"  
SecRule &amp;REQUEST_HEADERS:Host "@eq 0" \
    "deny,log,status:400,id:960008,severity:4,msg:'Request Missing a Host Header'"
SecRule &amp;REQUEST_HEADERS:Accept "@eq 0" \
    "log,deny,log,status:400,id:960015,msg:'Request Missing an Accept Header'"</pre></p><p><span class="bold"><strong>Note</strong></span></p><p>Skip only applies to the current processing phase and not
      necessarily the order in which the rules appear in the configuration
      file. If you group rules by processing phases, then skip should work as
      expected. This action can not be used to skip rules within one chain.
      Accepts a single paramater denoting the number of rules (or chains) to
      skip.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N113BA"></a><code class="literal">status</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Specifies the
      response status code to use with actions<code class="literal">
      deny</code> and<code class="literal"> redirect</code>.</p><p><span class="bold"><strong>Action Group:</strong></span> Disruptive</p><p>Example:</p><pre class="programlisting">SecDefaultAction log,deny,<span class="bold"><strong>status:403</strong></span>,phase:1</pre><p><span class="bold"><strong>Note</strong></span></p><p>Staus actions defined in Apache scope locations (such as
      Directory, Location, etc...) may be superceded by phase:1 action
      settings. The Apache ErrorDocument directive will be triggered if
      present in the configuration. Therefore if you have previously defined a
      custom error page for a given status then it will be executed and its
      output presented to the user.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N113DF"></a><code class="literal">t</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This action can be
      used which transformation function should be used against the specified
      variables before they (or the results, rather) are run against the
      operator specified in the rule.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecDefaultAction log,deny,phase:1,t:removeNulls,t:lowercase 
SecRule REQUEST_COOKIES:SESSIONID "47414e81cbbef3cf8366e84eeacba091" \
    log,deny,status:403,<span class="bold"><strong>t:md5</strong></span></pre><p><span class="bold"><strong>Note</strong></span></p><p>Any transformation functions that you specify in a SecRule will be
      in addtion to previous ones specified in SecDefaultAction. Use of
      "t:none" will remove all transformation functions for the specified
      rule.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N113FB"></a><code class="literal">xmlns</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This action should
      be used together with an XPath expression to register a
      namespace.</p><p><span class="bold"><strong>Action Group:</strong></span>
      Non-Disruptive</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:Content-Type "text/xml" \
    phase:1,pass,ctl:requestBodyProcessor=XML,ctl:requestBodyAccess=On,<span class="bold"><strong>xmlns:xsd="http://www.w3.org/2001/XMLSchema"</strong></span>
SecRule XML:/soap:Envelope/soap:Body/q1:getInput/id() "123" phase:2,deny</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="08-operators"></a>Operators</h2></div></div><div></div></div><p>A number of operators can be used in rules, as documented below. The
    operator syntax used the "@" symbol followed by the specific operator
    name.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11418"></a><code class="literal">eq</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This operator is a
      numerical comparison and stands for "equal to."</p><p>Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS_NAMES "<span class="bold"><strong>@eq</strong></span> 15"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1142A"></a><code class="literal">ge</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This operator is a
      numerical comparison and stands for "greater than or equal to."</p><p>Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS_NAMES "<span class="bold"><strong>@ge</strong></span> 15"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1143C"></a><code class="literal">gt</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This operator is a
      numerical comparison and stands for "greater than."</p><p>Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS_NAMES "<span class="bold"><strong>@gt</strong></span> 15"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1144E"></a><code class="literal">inspectFile</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Executes the
      external script/binary given as parameter to the operator against every
      file extracted from the request.</p><p>Example:</p><pre class="programlisting">SecRule FILES_TMPNAMES "<span class="bold"><strong>@inspectFile</strong></span> /opt/apache/bin/inspect_script.pl"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11460"></a><code class="literal">le</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This operator is a
      numerical comparison and stands for "less than or equal to."</p><p>Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS_NAMES "<span class="bold"><strong>@le</strong></span> 15"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11472"></a><code class="literal">lt</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This operator is a
      numerical comparison and stands for "less than."</p><p>Example:</p><pre class="programlisting">SecRule &amp;REQUEST_HEADERS_NAMES "<span class="bold"><strong>@lt </strong></span>15"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11484"></a><code class="literal">rbl</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Look up the
      parameter in the RBL given as parameter. Parameter can be an IPv4
      address, or a hostname.</p><p>Example:</p><pre class="programlisting">SecRule REMOTE_ADDR "<span class="bold"><strong>@rbl</strong></span> sc.surbl.org"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11496"></a><code class="literal">rx</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Regular expression
      operator. This is the default operator, so if the "@" operator is not
      defined, it is assumed to be rx.</p><p>Example:</p><pre class="programlisting">SecRule REQUEST_HEADERS:User-Agent "<span class="bold"><strong>@rx</strong></span> nikto"</pre><p><span class="bold"><strong>Note</strong></span></p><p>Regular expressions are handled by the PCRE library (<a href="http://www.pcre.org" target="_top">http://www.pcre.org</a>). ModSecurity
      compiles its regular expressions with the following settings:</p><div class="orderedlist"><ol type="1"><li><p>The entire input is treated as a single line, even when there
          are newline characters present.</p></li><li><p>All matches are case-sensitive. If you do not care about case
          sensitivity you either need to implement the <code class="literal">lowercase</code> transformational function, or
          use the per-pattern<code class="literal">(?i)</code>modificator, as allowed by
          PCRE.</p></li><li><p>The <code class="literal">PCRE_DOTALL</code> and
          <code class="literal">PCRE_DOLLAR_ENDONLY</code> flags are set
          during compilation, meaning a single dot will match any character,
          including the newlines and a <code class="literal">$</code>
          end anchor will not match a trailing newline charater.</p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N114D2"></a><code class="literal">validateByteRange</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Validates the byte
      range used in the variable falls into the specified range.</p><p>Example:</p><pre class="programlisting">SecRule ARG:text "<span class="bold"><strong>@validateByteRange</strong></span> 10, 13, 32-126"</pre><p><span class="bold"><strong>Note</strong></span></p><p>You can force requests to consist only of bytes from a certain
      byte range. This can be useful to avoid stack overflow attacks (since
      they usually contain "random" binary content). Default range values are
      0 and 255, i.e. all byte values are allowed. This directive does not
      check byte range in a POST payload when multipart/form-data encoding
      (file upload) is used. Doing so would prevent binary files from being
      uploaded. However, after the parameters are extracted from such request
      they are checked for a valid range.</p><p>validateByteRange is similar to the ModSecurity 1.X
      SecFilterForceByteRange Directive however since it works in a rule
      context, it has the following differences:</p><div class="itemizedlist"><ul type="disc"><li><p>You can specify a different range for different
          variables.</p></li><li><p>It has an "event" context (id, msg....)</p></li><li><p>It is executed in the flow of rules rather than being a built
          in pre-check.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N114F6"></a><code class="literal">validateDTD</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This operator
      requires the request body to be processed as XML.</p><p>Example:</p><pre class="programlisting">SecDefaultAction log,deny,status:403,phase:2
SecRule REQUEST_HEADERS:Content-Type ^text/xml$ \
    phase:1,t:lowercase,nolog,pass,ctl:requestBodyProcessor=XML
SecRule REQBODY_PROCESSOR "!^XML$" nolog,pass,skip:1
SecRule XML "<span class="bold"><strong>@validateDTD /path/to/apache2/conf/xml.dtd</strong></span>"</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11508"></a><code class="literal">validateSchema</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> This operator
      requires the request body to be processed as XML.</p><p>Example:</p><pre class="programlisting">SecDefaultAction log,deny,status:403,phase:2
SecRule REQUEST_HEADERS:Content-Type ^text/xml$ \
    phase:1,t:lowercase,nolog,pass,ctl:requestBodyProcessor=XML
SecRule REQBODY_PROCESSOR "!^XML$" nolog,pass,skip:1
SecRule XML "<span class="bold"><strong>@validateSchema /path/to/apache2/conf/xml.xsd</strong></span>"</pre><p>This operator requires request body to be processed as XML.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N1151C"></a><code class="literal">validateUrlEncoding</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Verifies the
      encodings used in the variable (if any) are valid.</p><p>Example:</p><pre class="programlisting">SecRule ARGS "<span class="bold"><strong>@validateUrlEncoding</strong></span>"</pre><p><span class="bold"><strong>Note</strong></span></p><p>URL encoding is an HTTP standard for encoding byte values within a
      URL. The byte is escaped with a % followed by two hexadecimal values
      (0-F). This directive does not check encoding in a POST payload when the
      multipart/form-data encoding (file upload) is used. It is not necessary
      to do so because URL encoding is not used for this encoding.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="N11534"></a><code class="literal">validateUtf8Encoding</code></h3></div></div><div></div></div><p><span class="bold"><strong>Description:</strong></span> Verifies the
      variable is a valid UTF-8 encoded string.</p><p>Example:</p><pre class="programlisting">SecRule ARGS "<span class="bold"><strong>@validateUtf8Encoding</strong></span>"</pre><p><span class="bold"><strong>Note</strong></span></p><p>UTF-8 encoding is valid on most web servers. Integer values
      between 0-65535 are encoded in a UTF-8 byte sequence that is escaped by
      percents. The short form is two bytes in length.</p><p>check for three types of errors:</p><div class="itemizedlist"><ul type="disc"><li><p>Not enough bytes. UTF-8 supports two, three, four, five, and
          six byte encodings. ModSecurity will locate cases when a byte or
          more is missing.</p></li><li><p>Invalid encoding. The two most significant bits in most
          characters are supposed to be fixed to 0x80. Attackers can use this
          to subvert Unicode decoders.</p></li><li><p>Overlong characters. ASCII characters are mapped directly into
          the Unicode space and are thus represented with a single byte.
          However, most ASCII characters can also be encoded with two, three,
          four, five, and six characters thus tricking the decoder into
          thinking that the character is something else (and, presumably,
          avoiding the security check).</p></li></ul></div></div></div></div><div align="center" class="copyright">Copyright (C) 2004-2006 <a href="http://www.breach.com">Breach Security</a></div></body></html>